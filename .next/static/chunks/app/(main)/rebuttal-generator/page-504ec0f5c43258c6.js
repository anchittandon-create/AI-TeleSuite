(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7481],{39863:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(95155),a=r(12115),o=r(32981),l=r(85762),i=r(87785),c=r(65363),s=r(18332),d=r(7545),u=r(15894),p=r(79313),f=r(36950),b=r(39437),g=r(13496),m=r(31524);function h(){let[e,t]=(0,a.useState)(null),[r,h]=(0,a.useState)(!1),[x,N]=(0,a.useState)(null),{toast:E}=(0,u.dj)(),{logActivity:v}=(0,p.Z)(),{files:w}=(0,b.J)(),{getProductByName:j}=(0,m.G)(),T=async e=>{h(!0),N(null),t(null);let r=e.product;if(!r){E({variant:"destructive",title:"Error",description:"Product must be selected."}),h(!1);return}let n=j(r);if(!n){E({variant:"destructive",title:"Error",description:"Selected product details not found."}),h(!1);return}let a=((e,t)=>{if(!t||!Array.isArray(e))return"No product or knowledge base provided.";let r=e.filter(e=>e.product===t.name);if(0===r.length)return"No specific knowledge base content found for this product.";let n="--- START OF KNOWLEDGE BASE CONTEXT FOR PRODUCT: ".concat(t.displayName," ---\n");n+="Product Description: ".concat(t.description||"Not provided.","\n"),t.brandName&&(n+="Brand Name: ".concat(t.brandName,"\n")),n+="--------------------------------------------------\n\n";let a=(e,t)=>{t.length>0&&(n+="--- ".concat(e.toUpperCase()," ---\n"),t.forEach(e=>{let t="\n--- Item: ".concat(e.name," ---\n");e.isTextEntry&&e.textContent?t+="Content:\n".concat(e.textContent,"\n"):t+="(This is a reference to a ".concat(e.type," file named '").concat(e.name,"'. The AI should infer context from its name, type, and category.)\n"),n.length+t.length<=3e4&&(n+=t)}),n+="--- END ".concat(e.toUpperCase()," ---\n\n"))},o=r.filter(e=>"Pitch"===e.category),l=r.filter(e=>"Product Description"===e.category),i=r.filter(e=>"Pricing"===e.category),c=r.filter(e=>"Rebuttals"===e.category),s=r.filter(e=>!e.category||!["Pitch","Product Description","Pricing","Rebuttals"].includes(e.category));return a("COMMON OBJECTIONS & REBUTTALS (Prioritize for handling specific objections)",c),a("PRODUCT DETAILS & PRICING (Prioritize for features, value, and cost-related objections)",[...l,...i]),a("PITCH & SALES FLOW CONTEXT",o),a("GENERAL SUPPLEMENTARY CONTEXT",s),n.length>=3e4&&(console.warn("Knowledge base context truncated due to length limit."),n+="\n... (Knowledge Base truncated due to length limit for AI context)\n"),(n+="--- END OF KNOWLEDGE BASE CONTEXT ---").substring(0,3e4)})(w,n);a.includes("No specific knowledge base content found")&&E({variant:"default",title:"Knowledge Base Incomplete",description:"No KB content found for ".concat(r,". The AI will use a high-quality fallback algorithm to generate the rebuttal."),duration:7e3});let l={...e,product:r,brandUrl:n.brandUrl,knowledgeBaseContext:a};try{let n=await (0,o.b)(l);t(n),n.rebuttal.startsWith("Cannot generate rebuttal:")||n.rebuttal.startsWith("Error generating rebuttal:")?(N(n.rebuttal),t(null),E({variant:"destructive",title:"Rebuttal Generation Failed",description:"The AI returned an error. See details below."})):E({title:"Rebuttal Generated!",description:"Suggested rebuttal has been successfully created using Knowledge Base content."}),v({module:"Rebuttal Generator",product:r,details:{rebuttalOutput:n,inputData:{objection:e.objection,product:r,knowledgeBaseContextProvided:!a.includes("No specific knowledge base content found")}}})}catch(n){console.error("Error generating rebuttal:",n);let t=n instanceof Error?n.message:"An unexpected error occurred.";N(t),E({variant:"destructive",title:"Error Generating Rebuttal",description:"An unexpected error occurred. See details below."}),v({module:"Rebuttal Generator",product:r,details:{error:t,inputData:{objection:e.objection,product:r,knowledgeBaseContextProvided:!a.includes("No specific knowledge base content found")}}})}finally{h(!1)}};return(0,n.jsxs)("div",{className:"flex flex-col h-full",children:[(0,n.jsx)(f.z,{title:"AI Rebuttal Assistant"}),(0,n.jsxs)("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 flex flex-col items-center",children:[(0,n.jsx)(l.u,{onSubmit:T,isLoading:r}),r&&(0,n.jsxs)("div",{className:"mt-8 flex flex-col items-center gap-2",children:[(0,n.jsx)(c.k,{size:32}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Generating rebuttal using Knowledge Base..."})]}),x&&!r&&(0,n.jsxs)(s.Fc,{variant:"destructive",className:"mt-8 max-w-lg",children:[(0,n.jsx)(d.A,{className:"h-4 w-4"}),(0,n.jsx)(s.XL,{children:"Rebuttal Generation Error"}),(0,n.jsx)(g.nD,{type:"single",collapsible:!0,className:"w-full",children:(0,n.jsxs)(g.As,{value:"item-1",className:"border-b-0",children:[(0,n.jsx)(g.$m,{className:"p-0 hover:no-underline text-sm [&_svg]:ml-1",children:"A generation error occurred. Click to view details."}),(0,n.jsx)(g.ub,{className:"pt-2",children:(0,n.jsx)("pre",{className:"text-xs whitespace-pre-wrap break-all bg-destructive/10 p-2 rounded-md font-mono",children:x})})]})})]}),e&&!r&&(0,n.jsx)(i.C,{rebuttal:e})]})]})}},85761:(e,t,r)=>{Promise.resolve().then(r.bind(r,39863))}},e=>{e.O(0,[4909,6077,9972,4037,2254,6414,6942,2410,7380,8713,8441,1255,7358],()=>e(e.s=85761)),_N_E=e.O()}]);