(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3204],{10062:(e,t,r)=>{Promise.resolve().then(r.bind(r,10786))},10786:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Q});var n=r(95155),a=r(12115),s=r(36950),i=r(3998),c=r(86948),l=r(11186),o=r(65142),d=r(76444),u=r(18332),m=r(17037),p=r(65363),x=r(21052),f=r(31120),h=r(15894),g=r(79313),v=r(39437),N=r(54762),w=r(31524),b=r(68217),j=r(67899),y=r(30926);let S=(0,y.createServerReference)("40f1d91439c67c38fca07d4a12627e2e11bf93ba9b",y.callServer,void 0,y.findSourceMapURL,"runVoiceSupportAgentQuery");var E=r(64201),I=r(80343),A=r(25212),C=r(5418),R=r(92033),T=r(2343),k=r(60406),U=r(36922),G=r(45444),L=r(86126),D=r(2996),O=r(47513),P=r(27314),F=r(92993),B=r(30664),V=r(53489),M=r(92649),K=r(94979),_=r(13496),W=r(11647),z=r(80158),H=r(85897),$=r(5282),q=r(19056),J=r(86259);let Z=(e,t,r)=>{let n="--- START OF KNOWLEDGE BASE CONTEXT FOR PRODUCT: ".concat(t.displayName," ---\n");n+="Description: ".concat(t.description||"Not provided","\n");let a=e.filter(e=>e.product===t.name),s=(e,t)=>{t.length>0&&(n+="--- ".concat(e.toUpperCase()," ---\n"),t.forEach(e=>{let t="\n--- Item: ".concat(e.name," ---\n");e.isTextEntry&&e.textContent?t+="Content:\n".concat(e.textContent,"\n"):t+="(This is a reference to a ".concat(e.type," file named '").concat(e.name,"'. The AI should infer context from its name, type, and category.)\n"),n.length+t.length<=3e4&&(n+=t)}),n+="--- END ".concat(e.toUpperCase()," ---\n\n"))},i=a.filter(e=>"Pitch"===e.category),c=a.filter(e=>"Product Description"===e.category),l=a.filter(e=>"Pricing"===e.category),o=a.filter(e=>"Rebuttals"===e.category),d=a.filter(e=>!e.category||!["Pitch","Product Description","Pricing","Rebuttals"].includes(e.category));return s("PRODUCT DETAILS, FEATURES, & PRICING (Source for factual information)",[...c,...l]),s("COMMON OBJECTIONS & REBUTTALS (Source for handling objections)",o),s("PITCH & SALES FLOW CONTEXT",i),s("GENERAL SUPPLEMENTARY CONTEXT",d),0===a.length&&(n+="No specific files or text entries were found for this product in the Knowledge Base.\n"),n.length>=3e4&&console.warn("Knowledge base context truncated due to length limit."),(n+="--- END OF KNOWLEDGE BASE CONTEXT ---").substring(0,3e4)},X=e=>"AI"===e?"AGENT":"USER";function Q(){let[e,t]=(0,a.useState)("CONFIGURING"),r=(0,a.useRef)(e);(0,a.useEffect)(()=>{r.current=e},[e]);let[y,K]=(0,a.useState)(null),Q=(0,a.useRef)(null),ee="undefined"!=typeof MediaRecorder,et=(0,a.useRef)(null);(0,a.useRef)([]);let[er,en]=(0,a.useState)(null),[ea,es]=(0,a.useState)(-1),[ei,ec]=(0,a.useState)(!1),{toast:el}=(0,h.dj)(),{activities:eo,logActivity:ed,updateActivity:eu}=(0,g.Z)(),{files:em}=(0,v.J)(),{availableProducts:ep,getProductByName:ex}=(0,w.G)(),ef=(0,a.useRef)(null),eh=(0,a.useRef)(null),[eg,ev]=(0,a.useState)(b.U[0].id),eN="CONFIGURING"!==e&&"IDLE"!==e&&"ENDED"!==e,[ew,eb]=(0,a.useState)(!1),[ej,ey]=(0,a.useState)("ET"),[eS,eE]=(0,a.useState)(""),[eI,eA]=(0,a.useState)(""),[eC,eR]=(0,a.useState)([]),[eT,ek]=(0,a.useState)(null),[eU,eG]=(0,a.useState)(""),[eL,eD]=(0,a.useState)(null),[eO,eP]=(0,a.useState)(!1),eF=(0,a.useRef)(null),eB=(0,a.useRef)(null),eV=(0,a.useRef)(null),eM=(0,a.useRef)(null),eK=(0,a.useRef)([]),e_=(0,a.useRef)(Date.now()),eW=(0,a.useRef)(null),ez=(0,a.useRef)(null),eH=(0,a.useRef)(null),e$=(0,a.useCallback)(async()=>{if(ee&&et.current){if(eB.current||(eB.current=new(window.AudioContext||window.webkitAudioContext)),"suspended"===eB.current.state)try{await eB.current.resume()}catch(e){console.warn("VoiceSupport: failed to resume audio context",e)}if(eV.current||(eV.current=eB.current.createMediaStreamDestination()),eW.current||(eW.current=await navigator.mediaDevices.getUserMedia({audio:!0})),eW.current&&!ez.current&&eV.current&&(ez.current=eB.current.createMediaStreamSource(eW.current),ez.current.connect(eV.current)),!eH.current&&eV.current&&(eH.current=eB.current.createMediaElementSource(et.current),eH.current.connect(eB.current.destination),eH.current.connect(eV.current)),eV.current&&!eM.current){let e=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":"audio/webm";eM.current=new MediaRecorder(eV.current.stream,{mimeType:e}),eM.current.ondataavailable=e=>{if(e.data.size>0){eK.current.push(e.data);let t=Date.now();if(t-e_.current>3e4){if(eK.current.length>600){let e=eK.current.length-600;eK.current.splice(0,e),console.log("VoiceSupport: Cleaned up ".concat(e," old audio chunks to prevent memory bloat"))}e_.current=t}eX()}}}eM.current&&"inactive"===eM.current.state&&(eK.current=[],eM.current.start(1e3))}},[ee]),eq=(0,a.useCallback)(async()=>{var e,t,r,n;if(!ee)return null;let a=null;if(eM.current&&"inactive"!==eM.current.state?a=await new Promise(e=>{let t=eM.current,r=()=>{t.removeEventListener("stop",r),e(new Blob(eK.current,{type:t.mimeType||"audio/webm"}))};t.addEventListener("stop",r),t.stop()}):eK.current.length>0&&(a=new Blob(eK.current,{type:(null==(n=eM.current)?void 0:n.mimeType)||"audio/webm"})),null==(e=eW.current)||e.getTracks().forEach(e=>e.stop()),eW.current=null,null==(t=ez.current)||t.disconnect(),ez.current=null,null==(r=eH.current)||r.disconnect(),eH.current=null,eV.current=null,eM.current=null,eK.current=[],eB.current){try{await eB.current.close()}catch(e){console.warn("VoiceSupport: failed to close audio context",e)}eB.current=null}return a},[ee]),eJ=(0,a.useCallback)(e=>new Promise((t,r)=>{let n=new FileReader;n.onloadend=()=>{"string"==typeof n.result?t(n.result):r(Error("Failed to read audio recording."))},n.onerror=()=>{var e;return r(null!=(e=n.error)?e:Error("Failed to read audio recording."))},n.readAsDataURL(e)}),[]),eZ=(0,a.useCallback)(()=>{if(eK.current.length>0){var e;return new Blob(eK.current,{type:(null==(e=eM.current)?void 0:e.mimeType)||"audio/webm"})}return null},[]),eX=(0,a.useCallback)(async()=>{let e=eZ();if(e)try{let t=await eJ(e);K(t)}catch(e){console.warn("Failed to update current recording:",e)}},[eZ,eJ]);(0,a.useEffect)(()=>{ef.current&&ef.current.scrollIntoView({behavior:"smooth"})},[eC,eU]);let eQ=(0,a.useCallback)(()=>{et.current&&(et.current.pause(),et.current.removeAttribute("src"),et.current.currentTime=0),en(null),es(-1),"AI_SPEAKING"===r.current&&t("LISTENING")},[]),eY=(0,a.useRef)(null),e0=(0,a.useCallback)((e,t)=>{let r=e.play();r&&"function"==typeof r.catch&&r.catch(e=>{var r;(null==e?void 0:e.name)==="AbortError"||(null==e||null==(r=e.message)?void 0:r.includes("The play() request was interrupted"))||t(e)})},[]),e1=(0,a.useCallback)((e,r)=>{et.current&&(et.current.pause(),et.current.src=e,et.current.currentTime=0,en(r),t("AI_SPEAKING"),e0(et.current,e=>{console.error("Audio playback error:",e),t("LISTENING")}))},[e0]),{isRecording:e4,startRecording:e2,stopRecording:e3}=(0,N.C)({onTranscriptionComplete:e=>{eY.current&&eY.current(e)},onTranscribe:e=>{"AI_SPEAKING"===r.current&&e.trim().length>0&&eQ(),eG(e)},inactivityTimeout:9e3,silenceTimeout:30}),e5=(0,a.useCallback)(async(e,r)=>{let n=performance.now();if(console.log("VoiceSupport: Starting support query processing for turn ".concat(r.length+1)),!ej||!eS.trim()){el({variant:"destructive",title:"Missing Info",description:"Please select a Product and enter an Agent Name."}),t("CONFIGURING");return}t("PROCESSING"),ek(null);let a=ex(ej);if(!a){el({variant:"destructive",title:"Error",description:"Selected product details not found."}),t("CONFIGURING");return}let s=(()=>{let e=eF.current,t=em.map(e=>"".concat(e.id,"-").concat(e.name,"-").concat(e.product,"-").concat(e.category)).join("|");if(e&&e.filesHash===t&&e.productName===a.name)return console.log("VoiceSupport: Using cached KB context (".concat(e.context.length," chars)")),e.context;let n=Z(em,a,r);return eF.current={filesHash:t,productName:a.name,context:n},console.log("VoiceSupport: Generated new KB context (".concat(n.length," chars)")),n})();s.startsWith("No specific knowledge base content found")&&el({variant:"default",title:"Limited KB",description:"Knowledge Base for ".concat(ej," is sparse. Answers may be general."),duration:5e3});let i={product:ej,agentName:eS,userName:eI,userQuery:e,knowledgeBaseContext:s,conversationHistory:r},c=async(e,r)=>{try{let n=e.replace(/\bET\b/g,"E T"),a=await (0,j.T)({text:n,voice:eg});eR(e=>e.map(e=>e.id===r?{...e,audioDataUri:a.audioDataUri}:e)),et.current&&(et.current.pause(),et.current.src=a.audioDataUri,et.current.currentTime=0,en(r),t("AI_SPEAKING"),e0(et.current,e=>{console.error("Audio playback error:",e),t("LISTENING")}))}catch(e){el({variant:"destructive",title:"TTS Error",description:e.message}),t("LISTENING")}};try{let e=performance.now(),a=await S(i),s=performance.now();if(console.log("VoiceSupport: AI flow completed in ".concat((s-e).toFixed(2),"ms")),a.errorMessage)throw Error(a.errorMessage);let l={id:"ai-".concat(Date.now()),speaker:"AI",text:a.aiResponseText||"(No response generated)",timestamp:new Date().toISOString()},o=[...r,l];eR(o),a.aiResponseText?await c(a.aiResponseText,l.id):t("LISTENING");let d={flowInput:i,flowOutput:a,fullTranscriptText:o.map(e=>"".concat(X(e.speaker),": ").concat(e.text)).join("\n"),fullConversation:o,error:a.errorMessage};eh.current?eu(eh.current,d):eh.current=ed({module:"AI Voice Support Agent",product:ej,details:d});let u=performance.now();console.log("VoiceSupport: Complete turn ".concat(r.length+1," processed in ").concat((u-n).toFixed(2),"ms"))}catch(n){let e=n.message||"An unexpected error occurred.";ek(e),t("ERROR");let r={id:"error-".concat(Date.now()),speaker:"AI",text:e,timestamp:new Date().toISOString()};eR(e=>[...e,r])}},[ej,eS,eI,ex,em,ed,eu,el,eg,e0]);eY.current=e=>{if("LISTENING"!==r.current&&"AI_SPEAKING"!==r.current)return;let t=e.trim();if(eG(""),!t)return void e5("",eC);let n=[...eC,{id:"user-".concat(Date.now()),speaker:"User",text:t,timestamp:new Date().toISOString()}];eR(n),e5(t,n)};let e6=(0,a.useCallback)(async function(){let e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Completed";if("ENDED"===r.current)return;e3(),eQ(),t("PROCESSING");let a=[...eC];try{let t=await eq();t&&t.size>0&&(e=await eJ(t))}catch(e){console.warn("VoiceSupport: failed to capture live recording, falling back to synthesis",e)}if(!e)try{let t=await (0,I.R)({conversationHistory:a,agentVoiceProfile:eg});t.audioDataUri?e=t.audioDataUri:t.errorMessage&&el({variant:"destructive",title:"Audio Generation Failed",description:t.errorMessage})}catch(e){el({variant:"destructive",title:"Audio Generation Error",description:e.message})}t("ENDED");let s=a.map(e=>{let t="AI"===e.speaker?"AGENT":"USER";return"[".concat((0,$.GP)((0,q.H)(e.timestamp),"HH:mm:ss"),"] ").concat(t,": ").concat(e.text)}).join("\n\n");if(eD({transcript:s,audioUri:e}),eh.current){let t=eo.find(e=>e.id===eh.current);t&&eu(eh.current,{...t.details,status:n,fullTranscriptText:s,fullConversation:a,fullCallAudioDataUri:e})}},[eC,eu,el,eg,e3,eQ,eo,eq,eJ,I.R]);(0,a.useEffect)(()=>{let e=et.current,n=()=>{en(null),es(-1),"AI_SPEAKING"===r.current&&t("LISTENING")},a=()=>{if(e&&!e.paused&&er){let t=eC.find(e=>e.id===er);if(t){let r=t.text.split(/(\s+)/),n=e.duration/(r.length||1);es(Math.floor(e.currentTime/n))}}};if(e)return e.addEventListener("ended",n),e.addEventListener("timeupdate",a),e.addEventListener("pause",n),()=>{e&&(e.removeEventListener("ended",n),e.removeEventListener("timeupdate",a),e.removeEventListener("pause",n))}},[eC,er]),(0,a.useEffect)(()=>{"LISTENING"!==e||e4?"LISTENING"!==e&&e4&&e3():e2()},[e,e4,e2,e3]),(0,a.useEffect)(()=>{let e=e=>{eN&&eh.current&&e6("Completed (Page Unloaded)")};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[eN,e6]);let e8=(0,a.useCallback)(async()=>{eb(!0);try{let e=await (0,j.T)({text:b.R,voice:eg}),t=new Audio(e.audioDataUri),r=t.play();r&&"function"==typeof r.catch&&r.catch(e=>{var t;(null==e?void 0:e.name)==="AbortError"||(null==e||null==(t=e.message)?void 0:t.includes("The play() request was interrupted"))||(console.error("Audio preview playback error:",e),el({variant:"destructive",title:"Audio Playback Error",description:"Could not play the generated voice sample."}),eb(!1))}),t.onended=()=>eb(!1),t.onerror=e=>{console.error("Audio preview playback error:",e),el({variant:"destructive",title:"Audio Playback Error",description:"Could not play the generated voice sample."}),eb(!1)}}catch(e){el({variant:"destructive",title:"TTS Error",description:e.message}),eb(!1)}},[eg,el]),e9=async()=>{var e;if(!ej||!eS.trim())return void el({variant:"destructive",title:"Missing Info",description:"Please select a Product and enter an Agent Name."});try{await e$()}catch(e){console.warn("VoiceSupport: Failed to set up recording graph, continuing without full audio recording",e)}let r="Hello ".concat(eI||"there",", this is ").concat(eS,". How can I help you today regarding ").concat((null==(e=ep.find(e=>e.name===ej))?void 0:e.displayName)||ej,"?"),n={id:"ai-".concat(Date.now()),speaker:"AI",text:r,timestamp:new Date().toISOString()};eR([n]),t("PROCESSING"),eh.current=ed({module:"AI Voice Support Agent",product:ej,details:{flowInput:{product:ej,agentName:eS,userName:eI,userQuery:"(Initiated Call)",knowledgeBaseContext:""},status:"In Progress"}});try{let e=await (0,j.T)({text:r,voice:eg});eR(t=>t.map(t=>t.id===n.id?{...t,audioDataUri:e.audioDataUri}:t)),et.current&&(et.current.pause(),et.current.src=e.audioDataUri,et.current.currentTime=0,en(n.id),t("AI_SPEAKING"),e0(et.current,e=>{console.error("Audio playback error:",e),t("LISTENING")}))}catch(e){el({variant:"destructive",title:"TTS Error on Welcome",description:e.message}),t("LISTENING")}},e7=async()=>{if(!eL||!eL.transcript||!ej)return void el({variant:"destructive",title:"Error",description:"No final transcript or product context available to score."});eP(!0);try{let e=ep.find(e=>e.name===ej),t=e?Z(em,e,[]):"No product context available.",r=await (0,E.t)({product:ej,agentName:eS,transcriptOverride:eL.transcript,productContext:t});if(eD(e=>e?{...e,score:r}:null),eh.current){let e=eo.find(e=>e.id===eh.current);e&&eu(eh.current,{...e.details,finalScore:r})}el({title:"Scoring Complete!",description:"The interaction has been scored successfully."})}catch(e){el({variant:"destructive",title:"Scoring Failed",description:e.message})}finally{eP(!1)}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("audio",{ref:et,className:"hidden"}),(0,n.jsxs)("div",{className:"flex flex-col h-full",children:[(0,n.jsx)(s.z,{title:"AI Voice Support Agent"}),(0,n.jsxs)("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-6",children:[(0,n.jsxs)(c.Zp,{className:"w-full max-w-3xl mx-auto",children:[(0,n.jsxs)(c.aR,{children:[(0,n.jsxs)(c.ZB,{className:"text-xl flex items-center",children:[(0,n.jsx)(U.A,{className:"mr-2 h-6 w-6 text-primary"})," AI Customer Support Configuration"]}),(0,n.jsx)(c.BT,{children:"Set up agent and customer context, product, and voice profile. The AI will automatically use the most relevant Knowledge Base content for its answers."})]}),(0,n.jsxs)(c.Wu,{className:"space-y-4",children:[(0,n.jsx)(_.nD,{type:"single",collapsible:!0,defaultValue:"CONFIGURING"===e?"item-config":"",className:"w-full",children:(0,n.jsxs)(_.As,{value:"item-config",children:[(0,n.jsx)(_.$m,{className:"text-md font-semibold hover:no-underline py-2 text-foreground/90 [&[data-state=open]>&svg]:rotate-180",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(G.A,{className:"mr-2 h-4 w-4 text-accent"}),"Context Configuration"]})}),(0,n.jsxs)(_.ub,{className:"pt-3 space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)(d.J,{children:["AI Voice Profile ",(0,n.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)(l.l6,{value:eg,onValueChange:ev,disabled:eN,children:[(0,n.jsx)(l.bq,{className:"flex-grow",children:(0,n.jsx)(l.yv,{placeholder:"Loading voices..."})}),(0,n.jsx)(l.gC,{children:b.U.map(e=>(0,n.jsx)(l.eb,{value:e.id,children:e.name},e.id))})]}),(0,n.jsx)(i.$,{variant:"outline",size:"sm",onClick:e8,disabled:ew||eN,children:ew?(0,n.jsx)(R.A,{className:"h-4 w-4 animate-spin"}):(0,n.jsx)(L.A,{className:"h-4 w-4"})})]})})]}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)(d.J,{htmlFor:"product-select-support",children:["Product ",(0,n.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,n.jsxs)(l.l6,{value:ej,onValueChange:e=>ey(e),disabled:eN,children:[(0,n.jsx)(l.bq,{id:"product-select-support",children:(0,n.jsx)(l.yv,{placeholder:"Select a Product"})}),(0,n.jsx)(l.gC,{children:ep.map(e=>(0,n.jsx)(l.eb,{value:e.name,children:e.displayName},e.name))})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)(d.J,{htmlFor:"support-agent-name",children:["Agent Name ",(0,n.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,n.jsx)(o.p,{id:"support-agent-name",placeholder:"e.g., SupportBot (AI)",value:eS,onChange:e=>eE(e.target.value),disabled:eN})]}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)(d.J,{htmlFor:"support-user-name",children:"Customer Name (Optional)"}),(0,n.jsx)(o.p,{id:"support-user-name",placeholder:"e.g., Priya Sharma",value:eI,onChange:e=>eA(e.target.value),disabled:eN})]})]})]})]})}),"CONFIGURING"===e&&(0,n.jsxs)(i.$,{onClick:e9,disabled:"CONFIGURING"!==e||!ej||!eS.trim(),className:"w-full mt-4",children:[(0,n.jsx)(D.A,{className:"mr-2 h-4 w-4"})," Start Interaction"]})]})]}),eN&&(0,n.jsxs)(c.Zp,{className:"w-full max-w-3xl mx-auto mt-4",children:[(0,n.jsxs)(c.aR,{children:[(0,n.jsxs)(c.ZB,{className:"text-lg flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(O.A,{className:"mr-2 h-5 w-5 text-primary"})," Ask a Question / Log Interaction"]}),(()=>{switch(e){case"LISTENING":return(0,n.jsxs)(W.E,{variant:"default",className:"text-xs bg-green-100 text-green-800",children:[(0,n.jsx)(A.A,{className:"mr-1.5 h-3.5 w-3.5"}),"Listening..."]});case"AI_SPEAKING":return(0,n.jsxs)(W.E,{variant:"outline",className:"text-xs bg-amber-100 text-amber-800",children:[(0,n.jsx)(C.A,{className:"mr-1.5 h-3.5 w-3.5"}),"AI Speaking (Interruptible)"]});case"PROCESSING":return(0,n.jsxs)(W.E,{variant:"secondary",className:"text-xs",children:[(0,n.jsx)(R.A,{className:"mr-1.5 h-3.5 w-3.5 animate-spin"}),"Processing..."]});case"ENDED":return(0,n.jsxs)(W.E,{variant:"secondary",className:"text-xs bg-gray-200 text-gray-600",children:[(0,n.jsx)(T.A,{className:"mr-1.5 h-3.5 w-3.5"}),"Ended"]});case"ERROR":return(0,n.jsxs)(W.E,{variant:"destructive",className:"text-xs",children:[(0,n.jsx)(k.A,{className:"mr-1.5 h-3.5 w-3.5"}),"Error"]});default:return(0,n.jsx)(W.E,{variant:"outline",className:"text-xs",children:"Idle"})}})()]}),(0,n.jsxs)(c.BT,{children:["Type your question below and hit send, or just start speaking. The AI will respond based on its Knowledge Base for product '",ej,"'."]})]}),(0,n.jsxs)(c.Wu,{children:[(0,n.jsxs)(m.F,{className:"h-[300px] w-full border rounded-md p-3 bg-muted/10 mb-3",children:[eC.map(e=>(0,n.jsx)(x.j,{turn:e,onPlayAudio:e1,currentlyPlayingId:er,wordIndex:e.id===er?ea:-1},e.id)),"LISTENING"===e&&(0,n.jsxs)("div",{className:"flex items-start gap-2.5 my-3 justify-end user-line",children:[(0,n.jsx)("div",{className:"flex flex-col gap-1 w-full max-w-[80%] items-end",children:(0,n.jsx)(c.Zp,{className:"max-w-full w-fit p-3 rounded-xl shadow-sm bg-accent/80 text-accent-foreground rounded-br-none",children:(0,n.jsx)(c.Wu,{className:"p-0 text-sm",children:(0,n.jsx)("p",{className:"italic",children:eU||" Listening..."})})})}),(0,n.jsx)(H.eu,{className:"h-8 w-8 shrink-0",children:(0,n.jsx)(H.q5,{className:"bg-accent text-accent-foreground",children:(0,n.jsx)(P.A,{size:18})})})]}),"PROCESSING"===e&&(0,n.jsx)(p.k,{size:16,className:"mx-auto my-2"}),(0,n.jsx)("div",{ref:ef})]}),y&&(0,n.jsxs)("div",{className:"mb-3 p-3 border rounded-md bg-muted/10",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,n.jsx)(A.A,{className:"h-4 w-4 text-primary"}),(0,n.jsx)("span",{className:"text-sm font-medium",children:"Live Call Recording"})]}),(0,n.jsx)("audio",{ref:Q,controls:!0,className:"w-full",src:y}),(0,n.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Full call recording - you can seek, rewind, and fast-forward"})]}),eT&&(0,n.jsx)(u.Fc,{variant:"destructive",className:"mb-3",children:(0,n.jsx)(_.nD,{type:"single",collapsible:!0,children:(0,n.jsxs)(_.As,{value:"item-1",className:"border-b-0",children:[(0,n.jsx)(_.$m,{className:"p-0 hover:no-underline text-sm font-semibold [&_svg]:ml-1",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(k.A,{className:"h-4 w-4 mr-2"})," An error occurred. Click to see details."]})}),(0,n.jsx)(_.ub,{className:"pt-2 text-xs",children:(0,n.jsx)("pre",{className:"whitespace-pre-wrap break-all bg-destructive/10 p-2 rounded-md font-mono",children:eT})})]})})}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground mb-2",children:"Optional: Type a response instead of speaking."}),(0,n.jsx)(Y,{onSubmit:e=>{let t=[...eC,{id:"user-".concat(Date.now()),speaker:"User",text:e,timestamp:new Date().toISOString()}];eR(t),eG(""),e5(e,t)},disabled:"LISTENING"!==e&&"AI_SPEAKING"!==e})]}),(0,n.jsxs)(c.wL,{className:"flex justify-between items-center pt-4",children:[(0,n.jsxs)(i.$,{onClick:()=>e6(),variant:"destructive",size:"sm",disabled:"PROCESSING"===e,children:[(0,n.jsx)(T.A,{className:"mr-2 h-4 w-4"})," End Interaction"]}),(0,n.jsxs)(i.$,{onClick:()=>{if(eh.current&&"CONFIGURING"!==r.current){let e=eo.find(e=>e.id===eh.current);e&&eu(eh.current,{...e.details,status:"Completed (Reset)",fullTranscriptText:eC.map(e=>"".concat(X(e.speaker),": ").concat(e.text)).join("\n"),fullConversation:eC}),el({title:"Interaction Logged",description:"The previous session was logged before resetting."})}t("CONFIGURING"),eh.current=null,eR([]),ek(null),eD(null),eG(""),eP(!1),eQ()},variant:"outline",size:"sm",children:[(0,n.jsx)(F.A,{className:"mr-2 h-4 w-4"})," New Interaction"]})]})]}),eL&&"ENDED"===e&&(0,n.jsxs)(c.Zp,{className:"w-full max-w-4xl mx-auto mt-4",children:[(0,n.jsxs)(c.aR,{children:[(0,n.jsx)(c.ZB,{children:"Interaction Review & Scoring"}),(0,n.jsx)(c.BT,{children:"Review the completed interaction transcript and score it."})]}),(0,n.jsxs)(c.Wu,{className:"space-y-4",children:[eL.audioUri&&(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{htmlFor:"final-audio-support",children:"Full Interaction Recording"}),(0,n.jsx)("audio",{id:"final-audio-support",controls:!0,src:eL.audioUri,className:"w-full mt-1 h-10",children:"Your browser does not support the audio element."}),(0,n.jsx)("div",{className:"mt-2 flex gap-2",children:(0,n.jsxs)(i.$,{variant:"outline",size:"xs",onClick:()=>(0,z.vG)(eL.audioUri,"SupportInteraction_".concat(eI||"User",".wav")),children:[(0,n.jsx)(B.A,{className:"mr-1 h-3"}),"Download Recording"]})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(d.J,{htmlFor:"final-transcript-support",children:"Full Transcript"}),(0,n.jsx)(f.T,{id:"final-transcript-support",value:eL.transcript,readOnly:!0,className:"h-40 text-xs bg-muted/50 mt-1"}),(0,n.jsx)("div",{className:"mt-2 flex gap-2",children:(0,n.jsxs)(i.$,{variant:"outline",size:"xs",onClick:()=>(0,z.U3)("SupportInteraction_".concat(eI||"User","_transcript.txt"),eL.transcript),children:[(0,n.jsx)(V.A,{className:"mr-1 h-3"}),"Download .txt"]})})]}),(0,n.jsx)(J.w,{}),eL.score?(0,n.jsxs)(u.Fc,{variant:"default",className:"bg-green-50 border-green-200",children:[(0,n.jsx)(u.XL,{className:"text-green-800",children:"Interaction Scored!"}),(0,n.jsxs)(u.TN,{className:"text-green-700",children:["Overall Score: ",eL.score.overallScore.toFixed(1),"/5 (",eL.score.callCategorisation,"). View details in the Call Scoring Dashboard."]})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"text-md font-semibold",children:"Score this Interaction"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Run AI analysis on the final transcript."}),(0,n.jsxs)(i.$,{onClick:e7,disabled:eO||!eL.transcript,children:[eO?(0,n.jsx)(R.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,n.jsx)(M.A,{className:"mr-2 h-4 w-4"}),eO?"Scoring...":"Run AI Scoring"]})]})]})]})]})]})]})}function Y(e){let{onSubmit:t,disabled:r}=e,[s,c]=(0,a.useState)("");return(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s.trim()&&(t(s),c(""))},className:"flex items-center gap-2",children:[(0,n.jsx)(o.p,{value:s,onChange:e=>c(e.target.value),placeholder:"Type your question here...",disabled:r,autoComplete:"off"}),(0,n.jsx)(i.$,{type:"submit",disabled:r||!s.trim(),children:(0,n.jsx)(K.A,{className:"h-4 w-4"})})]})}},31120:(e,t,r)=>{"use strict";r.d(t,{T:()=>i});var n=r(95155),a=r(12115),s=r(64269);let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...a})});i.displayName="Textarea"},64201:(e,t,r)=>{"use strict";r.d(t,{t:()=>a});var n=r(30926);let a=(0,n.createServerReference)("40592173cbe840837a40a5f15804c0744f59f71582",n.callServer,void 0,n.findSourceMapURL,"scoreCall")},80158:(e,t,r)=>{"use strict";function n(e,t){if(!t||!t.length)return;let r=Object.keys(t[0]),n=new Blob([r.join(",")+"\n"+t.map(e=>r.map(t=>{let r=null===e[t]||void 0===e[t]?"":e[t];return(r=r instanceof Date?r.toLocaleString():r.toString().replace(/"/g,'""')).search(/("|,|\n)/g)>=0&&(r='"'.concat(r,'"')),r}).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");if(void 0!==a.download){let t=URL.createObjectURL(n);a.setAttribute("href",t),a.setAttribute("download",e),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}}function a(e,t){let r=new Blob([t],{type:e.endsWith(".doc")?"application/msword":"text/plain;charset=utf-8;"}),n=document.createElement("a");if(void 0!==n.download){let t=URL.createObjectURL(r);n.setAttribute("href",t),n.setAttribute("download",e),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}}async function s(e,t){if(!e)return void console.error("No audio reference provided, cannot download.");let r=null;if(e.startsWith("data:")){if(!(r=function(e){if(!e||!e.includes(","))return null;try{let t=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),a=new Uint8Array(n);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);return new Blob([n],{type:r})}catch(e){return console.error("Error converting data URI to Blob:",e),null}}(e)))return void console.error("Failed to convert Data URI to Blob for download.")}else try{let t=await fetch(e);if(!t.ok)throw Error("Failed to fetch audio asset (".concat(t.status,")"));r=await t.blob()}catch(e){console.error("Unable to download remote audio asset:",e);return}let n=document.createElement("a");if(void 0!==n.download&&r){let e=URL.createObjectURL(r);n.setAttribute("href",e),n.setAttribute("download",t),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(e)}}function i(e,t,r){let n=function(e,t,r){let n="",a=e.map((e,r)=>{let n=e.length;return t.forEach(e=>{let t=String(null===e[r]||void 0===e[r]?"":e[r]);t.length>n&&(n=t.length)}),n}),s=e.map((e,t)=>e.padEnd(a[t])).join(" | ");return n+=s+"\n"+e.map((e,t)=>"-".repeat(a[t])).join("-+-")+"\n",t.forEach(e=>{let t=e.map((e,t)=>String(null==e?"":e).padEnd(a[t])).join(" | ");n+=t+"\n"}),n}(t,r);a(e.endsWith(".doc")?e:"".concat(e,".doc"),n)}async function c(e,t,n){let{jsPDF:a}=await Promise.all([r.e(3930),r.e(5033),r.e(6241)]).then(r.bind(r,55172)),{default:s}=await r.e(6941).then(r.bind(r,36941)),i=new a({orientation:"landscape"});s(i,{head:[t],body:n,styles:{fontSize:8},headStyles:{fillColor:[41,128,185]},margin:{top:20},didDrawPage:function(e){i.setFontSize(16),i.text("Exported Table Data",e.settings.margin.left,15)}}),i.save(e.endsWith(".pdf")?e:"".concat(e,".pdf"))}r.d(t,{U3:()=>a,e3:()=>c,mf:()=>i,vG:()=>s,yR:()=>n})}},e=>{e.O(0,[4909,6077,9972,6107,8458,4037,312,2254,5419,2410,7380,1847,8441,1255,7358],()=>e(e.s=10062)),_N_E=e.O()}]);