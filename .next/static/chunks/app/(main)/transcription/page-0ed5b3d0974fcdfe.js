(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1256],{37194:(e,s,r)=>{Promise.resolve().then(r.bind(r,68653))},68653:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>H,maxDuration:()=>V});var a=r(95155),t=r(12115),i=r(36950),n=r(3998),l=r(86948),c=r(65142),o=r(76444),d=r(65363),m=r(18332),u=r(97776),x=r(7545),p=r(15894),h=r(79313),f=r(14482),j=r(87270),g=r(6259),N=r(51834),v=r(17037),w=r(80158),b=r(15039),y=r(19201),A=r(60406),T=r(36654),C=r(59007),S=r(5225),k=r(25212),F=r(92649),E=r(81288),z=r(53489),D=r(30664),P=r(11647),U=r(13406),O=r(40710),$=r(64201),_=r(31524),I=r(11186),X=r(75335),B=r(39437);function M(e){let{results:s}=e,[r,i]=(0,t.useState)(null),[l,o]=(0,t.useState)(!1),[m,u]=(0,t.useState)(!1),[x,f]=(0,t.useState)(void 0),[M,G]=(0,t.useState)(void 0),[R,V]=(0,t.useState)(""),{logActivity:L}=(0,h.Z)(),{availableProducts:H,getProductByName:Z}=(0,_.G)(),{files:J}=(0,B.J)(),{toast:W}=(0,p.dj)(),q=async()=>{if(!r||!x)return void W({variant:"destructive",title:"Error",description:"A result and product must be selected to score."});u(!0);try{let e=Z(x);if(!e)throw Error("Could not find product details for scoring context.");let s=((e,s)=>{let r="Product Display Name: ".concat(e.displayName,"\n");e.description&&(r+="Description: ".concat(e.description,"\n")),e.brandName&&(r+="Brand Name: ".concat(e.brandName,"\n")),e.brandUrl&&(r+="Brand URL: ".concat(e.brandUrl,"\n"));let a=s.filter(s=>s.product===e.name);return a.length>0&&(r+="\n--- Associated Knowledge Base Entries ---\n",a.forEach(e=>{r+="\nItem: ".concat(e.name,"\nType: ").concat(e.isTextEntry?"Text Entry":e.type,"\n"),e.isTextEntry&&e.textContent&&(r+="Content: ".concat(e.textContent.substring(0,2e3),"...\n"))})),r})(e,J),a={product:x,agentName:R,transcriptOverride:r.diarizedTranscript,productContext:s},t=await (0,$.t)(a);G(t),L({module:"Call Scoring",product:x,details:{fileName:r.fileName,scoreOutput:t,agentNameFromForm:R||"N/A (from transcription)",error:"Error"===t.callCategorisation?t.summary:void 0}}),W({title:"Scoring Complete",description:"Scored against ".concat(x," product context.")})}catch(e){W({variant:"destructive",title:"Scoring Failed",description:e.message})}finally{u(!1)}},Q=(e,s)=>{if(e&&s)try{let r=(s.includes(".")?s.substring(0,s.lastIndexOf(".")):s)+"_transcript.txt";(0,w.U3)(r,e),W({title:"Success",description:"Transcript TXT file downloaded."})}catch(e){W({variant:"destructive",title:"Error",description:"Failed to download TXT file."})}},K=(e,s)=>{if(!e||!s)return void W({variant:"destructive",title:"Error",description:"Transcript content not found for PDF export."});let r=(s?s.includes(".")?s.substring(0,s.lastIndexOf(".")):s:"transcript")+"_transcript.pdf";exportTextContentToPdf(e,r),W({title:"Success",description:"Transcript PDF '".concat(r,"' downloaded.")})},Y=e=>{if(!e)return(0,a.jsx)(b.A,{className:"h-3.5 w-3.5 text-muted-foreground inline-block align-middle"});let s=e.toLowerCase();return s.includes("high")?(0,a.jsx)(y.A,{className:"h-3.5 w-3.5 text-green-500 inline-block align-middle"}):s.includes("medium")?(0,a.jsx)(y.A,{className:"h-3.5 w-3.5 text-yellow-500 inline-block align-middle"}):s.includes("low")||s.includes("error")?(0,a.jsx)(b.A,{className:"h-3.5 w-3.5 text-red-500 inline-block align-middle"}):(0,a.jsx)(b.A,{className:"h-3.5 w-3.5 text-muted-foreground inline-block align-middle"})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"w-full max-w-5xl mt-8 shadow-lg rounded-lg border bg-card",children:[(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-primary",children:"Transcription Summary"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Transcription results for ",s.length," file(s)."]})]}),(0,a.jsx)(v.F,{className:"h-[calc(100vh-450px)] md:h-[500px]",children:(0,a.jsxs)(j.XI,{children:[(0,a.jsx)(j.A0,{className:"sticky top-0 bg-muted/50 backdrop-blur-sm z-10",children:(0,a.jsxs)(j.Hj,{children:[(0,a.jsx)(j.nd,{className:"w-[50px]",children:"SNo."}),(0,a.jsx)(j.nd,{children:"File Name"}),(0,a.jsx)(j.nd,{children:"Transcript Preview"}),(0,a.jsx)(j.nd,{className:"text-center w-[200px]",children:"Accuracy Assessment"}),(0,a.jsx)(j.nd,{className:"text-center w-[100px]",children:"Status"}),(0,a.jsx)(j.nd,{className:"text-right w-[150px]",children:"Actions"})]})}),(0,a.jsx)(j.BF,{children:0===s.length?(0,a.jsx)(j.Hj,{children:(0,a.jsx)(j.nA,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"No transcription results to display."})}):s.map((e,s)=>(0,a.jsxs)(j.Hj,{children:[(0,a.jsx)(j.nA,{children:s+1}),(0,a.jsx)(j.nA,{className:"font-medium max-w-xs truncate",title:e.fileName,children:e.fileName}),(0,a.jsx)(j.nA,{className:"max-w-sm",children:e.error?(0,a.jsx)("span",{className:"text-destructive italic text-xs",children:e.diarizedTranscript}):(0,a.jsx)(v.F,{className:"h-16 max-w-full",children:(0,a.jsxs)("p",{className:"text-xs text-muted-foreground whitespace-pre-wrap break-words",children:[e.diarizedTranscript.substring(0,200),e.diarizedTranscript.length>200&&"..."]})})}),(0,a.jsxs)(j.nA,{className:"text-center text-xs",title:e.accuracyAssessment,children:[Y(e.accuracyAssessment)," ",e.accuracyAssessment||"N/A"]}),(0,a.jsx)(j.nA,{className:"text-center",children:e.error?(0,a.jsxs)(P.E,{variant:"destructive",className:"cursor-default text-xs",title:e.error,children:[(0,a.jsx)(A.A,{className:"mr-1 h-3 w-3"})," Error"]}):(0,a.jsx)(P.E,{variant:"secondary",className:"bg-green-100 text-green-700 border-green-300 text-xs",children:"Success"})}),(0,a.jsxs)(j.nA,{className:"text-right space-x-1",children:[(0,a.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>(e=>{if(e.error&&!e.audioDataUri)return void W({variant:"destructive",title:"Cannot View Transcript for ".concat(e.fileName),description:"This file could not be transcribed and audio is unavailable."});i(e),G(e.scoreOutput),f(void 0),V(""),o(!0)})(e),disabled:!!e.error&&!e.audioDataUri,title:e.error&&!e.audioDataUri?"Transcription failed, audio unavailable":"View Full Transcript / Play Audio",children:[(0,a.jsx)(T.A,{className:"mr-1.5 h-4 w-4"})," View"]}),(0,a.jsxs)(g.rI,{children:[(0,a.jsx)(g.ty,{asChild:!0,children:(0,a.jsx)(n.$,{variant:"outline",size:"icon",className:"h-9 w-9",disabled:!!e.error,title:e.error?"Cannot download, transcription failed":"Download options",children:(0,a.jsx)(C.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(g.SQ,{align:"end",children:[(0,a.jsxs)(g._2,{onClick:()=>Q(e.diarizedTranscript,e.fileName),children:[(0,a.jsx)(S.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Download as TXT"})]}),(0,a.jsxs)(g._2,{onClick:()=>K(e.diarizedTranscript,e.fileName),children:[(0,a.jsx)(S.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Download as PDF"})]})]})]})]})]},e.id))})]})})]}),r&&(0,a.jsx)(N.lG,{open:l,onOpenChange:o,children:(0,a.jsxs)(N.Cf,{className:"sm:max-w-3xl md:max-w-4xl lg:max-w-5xl h-[85vh] flex flex-col p-0",children:[(0,a.jsx)(N.c7,{className:"p-6 pb-2 border-b",children:(0,a.jsx)("div",{className:"flex justify-between items-start",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)(N.L3,{className:"text-primary flex items-center",children:[(0,a.jsx)(k.A,{className:"mr-2 h-5 w-5"}),"Transcription & Scoring Result"]}),(0,a.jsxs)(N.rr,{children:["File: ",r.fileName]})]})})}),(0,a.jsx)("div",{className:"flex-grow p-4 sm:p-6 overflow-y-auto",children:(0,a.jsxs)(U.tU,{defaultValue:"scoring",className:"w-full",children:[(0,a.jsxs)(U.j7,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(U.Xi,{value:"scoring",children:"AI Call Scoring"}),(0,a.jsx)(U.Xi,{value:"transcript",children:"Full Transcript"})]}),(0,a.jsx)(U.av,{value:"scoring",className:"mt-4",children:M?(0,a.jsx)(O.o,{results:M,fileName:r.fileName,audioDataUri:r.audioDataUri,agentName:R,product:x}):(0,a.jsxs)("div",{className:"mt-4 p-4 border rounded-lg bg-muted/30",children:[(0,a.jsx)("h4",{className:"font-semibold text-md mb-2",children:"Score this Transcript"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,a.jsx)(c.p,{placeholder:"Agent Name (Optional)",value:R,onChange:e=>V(e.target.value),className:"w-[180px] h-9"}),(0,a.jsxs)(I.l6,{onValueChange:e=>f(e),value:x,children:[(0,a.jsx)(I.bq,{className:"w-[220px] h-9",children:(0,a.jsx)(I.yv,{placeholder:"Select Product for Scoring"})}),(0,a.jsx)(I.gC,{children:H.map(e=>(0,a.jsx)(I.eb,{value:e.name,children:e.displayName},e.name))})]}),(0,a.jsxs)(n.$,{onClick:q,disabled:m||!x||!!r.error,children:[m?(0,a.jsx)(d.k,{size:16,className:"mr-2"}):(0,a.jsx)(F.A,{className:"mr-2 h-4 w-4"}),m?"Scoring...":"Run Score"]})]})]})}),(0,a.jsxs)(U.av,{value:"transcript",className:"mt-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center flex-wrap gap-2 mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",title:"Accuracy: ".concat(r.accuracyAssessment),children:[Y(r.accuracyAssessment),"Accuracy Assessment: ",(0,a.jsx)("strong",{children:r.accuracyAssessment})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(n.$,{variant:"outline",size:"xs",onClick:()=>{var e;(e=r.diarizedTranscript||r.error||"")&&navigator.clipboard.writeText(e).then(()=>W({title:"Success",description:"Transcript copied to clipboard!"})).catch(()=>W({variant:"destructive",title:"Error",description:"Failed to copy transcript."}))},disabled:!r.diarizedTranscript&&!r.error,children:[(0,a.jsx)(E.A,{className:"mr-1 h-3"}),"Copy Txt"]}),(0,a.jsxs)(n.$,{variant:"outline",size:"xs",onClick:()=>Q(r.diarizedTranscript,r.fileName),disabled:!!r.error,children:[(0,a.jsx)(z.A,{className:"mr-1 h-3"}),"TXT"]}),(0,a.jsxs)(n.$,{variant:"outline",size:"xs",onClick:()=>K(r.diarizedTranscript,r.fileName),disabled:!!r.error,children:[(0,a.jsx)(S.A,{className:"mr-1 h-3"}),"PDF"]}),r.audioDataUri&&(0,a.jsxs)(n.$,{variant:"outline",size:"xs",onClick:()=>((e,s)=>{if(!e)return void W({variant:"destructive",title:"Download Failed",description:"Audio data is not available for this file."});try{(0,w.vG)(e,s||"audio_recording.unknown"),W({title:"Download Started",description:"Downloading ".concat(s,"...")})}catch(e){console.error("Error downloading audio file:",e),W({variant:"destructive",title:"Download Error",description:"Could not download the audio file."})}})(r.audioDataUri,r.fileName),children:[(0,a.jsx)(D.A,{className:"mr-1 h-3"}),"Audio"]})]})]}),r.audioDataUri&&(0,a.jsx)("div",{className:"mt-3 mb-3",children:(0,a.jsx)("audio",{controls:!0,src:r.audioDataUri,className:"w-full h-10",children:"Your browser does not support the audio element."})}),r.error?(0,a.jsx)("div",{className:"h-64 flex items-center justify-center",children:(0,a.jsxs)("p",{className:"text-destructive text-center p-4",children:["Error transcribing file: ",r.error]})}):(0,a.jsx)(v.F,{className:"h-[400px] w-full rounded-md border p-3 bg-background",children:(0,a.jsx)(X.X,{transcript:r.diarizedTranscript})})]})]})}),(0,a.jsx)(N.Es,{className:"p-4 border-t bg-muted/50",children:(0,a.jsx)(n.$,{onClick:()=>o(!1),size:"sm",children:"Close"})})]})})]})}var G=r(13496),R=r(17242);let V=300,L=["audio/mpeg","audio/wav","audio/mp4","audio/x-m4a","audio/ogg","audio/webm","audio/aac","audio/flac"];function H(){let[e,s]=(0,t.useState)([]),[r,j]=(0,t.useState)(!1),[g,N]=(0,t.useState)(null),[v,w]=(0,t.useState)([]),[b,y]=(0,t.useState)(0),[A,T]=(0,t.useState)([]),{toast:C}=(0,p.dj)(),{logActivity:S}=(0,h.Z)(),k=(0,t.useId)(),F=(e,s)=>{T(r=>{let a=r.findIndex(s=>s.fileName===e);if(-1===a)return r;let t=[...r];return t[a]={...t[a],...s},t})},E=async()=>{if(0===v.length)return void N("Please select one or more audio files first.");j(!0),N(null),s([]),y(0),T(v.map((e,s)=>({id:"".concat(k,"-progress-").concat(s),fileName:e.name,step:"Queued",status:"queued",progress:0})));let e=[];for(let r=0;r<v.length;r++){let a=v[r];y(r+1),F(a.name,{step:"Preparing audio",status:"running",progress:15});let t="";try{let i;t=await (0,f.zM)(a),F(a.name,{step:"Uploading to AI service",status:"running",progress:40});let n={audioDataUri:t},l=await fetch("/api/transcription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!l.ok)throw Error("Transcription API failed: ".concat(l.statusText));let c=await l.json();F(a.name,{step:"Generating transcript",status:"running",progress:75});let o=c.segments.map(e=>"".concat(e.speaker,": ").concat(e.text)).join("\n"),d="Completed";(""===o.trim()||o.startsWith("[")&&o.toLowerCase().includes("error"))&&(i=o||"Transcription failed for ".concat(a.name,"."));let m={id:"".concat(k,"-").concat(a.name,"-").concat(r),fileName:a.name,audioDataUri:t,diarizedTranscript:o,accuracyAssessment:d,error:i};e.push(m),s([...e]),F(a.name,{step:"Completed",status:"success",progress:100,message:i?void 0:"Accuracy: ".concat(d)}),S({module:"Transcription",product:"General",details:{fileName:a.name,transcriptionOutput:c,error:i}})}catch(l){let i=l instanceof Error?l.message:"An unexpected error occurred.",n={id:"".concat(k,"-").concat(a.name,"-").concat(r),fileName:a.name,audioDataUri:t,diarizedTranscript:"[Critical Error processing file: ".concat(i,"]"),accuracyAssessment:"Error",error:i};e.push(n),s([...e]),F(a.name,{step:"Failed",status:"failed",progress:100,message:i}),S({module:"Transcription",product:"General",details:{fileName:a.name,error:i,transcriptionOutput:{callMeta:{sampleRateHz:null,durationSeconds:null},segments:[],summary:{overview:"",keyPoints:[],actions:[]}}}}),C({variant:"destructive",title:"Transcription Failed for ".concat(a.name),description:i})}}j(!1),C({title:"All Files Processed",description:"Finished processing all ".concat(v.length," file(s).")})};return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)(i.z,{title:"Audio Transcription"}),(0,a.jsxs)("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 flex flex-col items-center space-y-8",children:[A.length>0&&(0,a.jsx)(R.c,{items:A,description:"Progress is updated for each file and step."}),(0,a.jsxs)(l.Zp,{className:"w-full max-w-xl shadow-lg",children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"text-xl flex items-center",children:[(0,a.jsx)(u.A,{className:"mr-2 h-6 w-6 text-primary"})," Transcribe Audio File(s)"]}),(0,a.jsx)(l.BT,{children:"Upload one or more audio files to get their text transcripts in English (Roman script), with speaker labels and accuracy assessment."})]}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid w-full items-center gap-1.5",children:[(0,a.jsxs)(o.J,{htmlFor:"audio-upload",children:["Audio File(s) ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsx)(c.p,{id:"audio-upload",type:"file",accept:L.join(","),onChange:e=>{N(null),s([]),T([]);let r=e.target.files;if(r&&r.length>0){let s=Array.from(r),a=[],t=!1;for(let e of s){if(e.size>0x6400000){N('File "'.concat(e.name,'" exceeds ').concat(100,"MB limit.")),t=!0;break}""===e.type||L.includes(e.type)||""===e.type||console.warn("Potentially unsupported audio type for ".concat(e.name,": ").concat(e.type,". Transcription may fail.")),a.push(e)}t?(w([]),e.target.value=""):w(a)}else w([])},multiple:!0,className:"pt-1.5"}),v.length>0&&(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Selected: ",v.length," file(s)"]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Supported: MP3, WAV, M4A, etc. (Max $",100,"MB per file)."]})]}),g&&!r&&(0,a.jsxs)(m.Fc,{variant:"destructive",className:"mt-4",children:[(0,a.jsx)(x.A,{className:"h-4 w-4"}),(0,a.jsx)(m.XL,{children:"Error"}),(0,a.jsx)(m.TN,{children:(0,a.jsx)(G.nD,{type:"single",collapsible:!0,children:(0,a.jsxs)(G.As,{value:"item-1",className:"border-b-0",children:[(0,a.jsx)(G.$m,{className:"p-0 hover:no-underline text-sm",children:"A file validation error occurred. Click to view details."}),(0,a.jsx)(G.ub,{className:"pt-2 text-xs",children:(0,a.jsx)("pre",{className:"whitespace-pre-wrap break-all bg-destructive/10 p-2 rounded-md font-mono",children:g})})]})})})]}),(0,a.jsx)(n.$,{onClick:E,disabled:r||0===v.length||!!g,className:"w-full",children:r?"Transcribing (".concat(b,"/").concat(v.length,")..."):"Transcribe ".concat(v.length>0?v.length:""," File(s)")})]})]}),r&&(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)(d.k,{size:32}),(0,a.jsx)("p",{className:"text-muted-foreground",children:v.length>1?"Processing file ".concat(b," of ").concat(v.length,"..."):"Processing audio..."})]}),e&&e.length>0&&(0,a.jsx)("div",{className:"w-full max-w-5xl space-y-4",children:(0,a.jsx)(M,{results:e})})]})]})}}},e=>{e.O(0,[2581,3930,5033,4909,6077,9972,6107,8458,4037,312,2254,6241,4589,2558,230,2410,7380,2535,710,696,8441,1255,7358],()=>e(e.s=37194)),_N_E=e.O()}]);