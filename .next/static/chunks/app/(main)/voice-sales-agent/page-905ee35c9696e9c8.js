(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5031],{20711:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>J});var a=r(95155),n=r(12115),s=r(67909),c=r(36950),l=r(3998),i=r(86948),o=r(11186),u=r(65142),d=r(76444),m=r(18332),p=r(17037),h=r(65363),f=r(21052),x=r(11647),g=r(15894),N=r(79313),v=r(39437),j=r(54762),w=r(31524),b=r(68217),E=r(67899),y=r(30926);let S=(0,y.createServerReference)("40481652c6e515f70ff0f4f0899456d583cb098e56",y.callServer,void 0,y.findSourceMapURL,"runVoiceSalesAgentTurn");var C=r(80343),I=r(92033),A=r(25212),T=r(5418),R=r(2343),P=r(60406),k=r(60412),D=r(45444),O=r(86126),G=r(10350),U=r(47513),L=r(27314),F=r(92993),V=r(13496),M=r(85897);let B=(0,s.default)(()=>Promise.all([r.e(2581),r.e(3930),r.e(5033),r.e(8458),r.e(312),r.e(6241),r.e(4589),r.e(2558),r.e(2535),r.e(710),r.e(4603)]).then(r.bind(r,54603)).then(e=>e.PostCallReview),{loadableGenerated:{webpack:()=>[54603]},loading:()=>(0,a.jsxs)("div",{className:"flex items-center justify-center p-8 text-muted-foreground",children:[(0,a.jsx)(I.A,{className:"mr-2 h-4 w-4 animate-spin"})," Loading call review..."]}),ssr:!1}),_=(e,t,r,a)=>{if(!t)return"No product information available.";let n="--- START OF KNOWLEDGE BASE CONTEXT FOR PRODUCT: ".concat(t.displayName," ---\n");n+="Brand Name: ".concat(t.brandName||"Not provided","\n"),a&&(n+="Target Customer Cohort: ".concat(a,"\n")),n+="--------------------------------------------------\n\n";let s=e.filter(e=>e.product===t.name),c=(e,t)=>{t.length>0&&(n+="--- ".concat(e.toUpperCase()," ---\n"),t.forEach(e=>{let t="\n--- Item: ".concat(e.name," ---\n");e.isTextEntry&&e.textContent?t+="Content:\n".concat(e.textContent,"\n"):t+="(This is a reference to a ".concat(e.type," file named '").concat(e.name,"'. The AI should infer context from its name, type, and category.)\n"),n.length+t.length<=3e4&&(n+=t)}),n+="--- END ".concat(e.toUpperCase()," ---\n\n"))},l=s.filter(e=>"Pitch"===e.category),i=s.filter(e=>"Product Description"===e.category),o=s.filter(e=>"Pricing"===e.category),u=s.filter(e=>"Rebuttals"===e.category),d=s.filter(e=>!e.category||!["Pitch","Product Description","Pricing","Rebuttals"].includes(e.category));return c("PITCH STRUCTURE & FLOW CONTEXT (Prioritize for overall script structure)",l),c("PRODUCT DETAILS & FACTS (Prioritize for benefits, features, pricing)",[...i,...o]),c("COMMON OBJECTIONS & REBUTTALS",u),c("GENERAL SUPPLEMENTARY CONTEXT",d),0===s.length&&(n+="No specific knowledge base files or text entries were found for this product.\n"),n.length>=3e4&&console.warn("Knowledge base context truncated due to length limit."),(n+="--- END OF KNOWLEDGE BASE CONTEXT ---").substring(0,3e4)},K=e=>"AI"===e?"AGENT":"USER";function J(){let[e,t]=(0,n.useState)("CONFIGURING"),s=(0,n.useRef)(e);(0,n.useEffect)(()=>{s.current=e},[e]);let[y,J]=(0,n.useState)(""),[q,z]=(0,n.useState)(!1),[H,W]=(0,n.useState)(""),[Z,$]=(0,n.useState)(""),{availableProducts:X,getProductByName:Y}=(0,w.G)(),[Q,ee]=(0,n.useState)("ET"),et=Y(Q||""),[er,ea]=(0,n.useState)(),[en,es]=(0,n.useState)(),[ec,el]=(0,n.useState)(""),[ei,eo]=(0,n.useState)("Payment Dropoff"),[eu,ed]=(0,n.useState)([]),[em,ep]=(0,n.useState)(null),[eh,ef]=(0,n.useState)(null),[ex,eg]=(0,n.useState)(null),[eN,ev]=(0,n.useState)(null),ej=(0,n.useRef)(null),ew="undefined"!=typeof MediaRecorder,eb=(0,n.useRef)(null),eE=(0,n.useRef)([]),[ey,eS]=(0,n.useState)(null),[eC,eI]=(0,n.useState)(-1),[eA,eT]=(0,n.useState)(!1),{toast:eR}=(0,g.dj)(),{activities:eP,logActivity:ek,updateActivity:eD}=(0,N.Z)(),{files:eO}=(0,v.J)(),eG=(0,n.useRef)(null),eU=(0,n.useRef)(null),[eL,eF]=(0,n.useState)(b.U[0].id),eV="CONFIGURING"!==e&&"IDLE"!==e&&"ENDED"!==e,[eM,eB]=(0,n.useState)(!1),e_=(0,n.useMemo)(()=>Q&&eO?eO.filter(e=>e.product===Q):[],[eO,Q]);(0,n.useEffect)(()=>{eK.current=null},[e_,Q,ei]);let eK=(0,n.useRef)(null),eJ=(0,n.useRef)(null),eq=(0,n.useRef)(null),ez=(0,n.useRef)(null),eH=(0,n.useRef)([]),eW=(0,n.useRef)(Date.now()),eZ=(0,n.useRef)(null),e$=(0,n.useRef)(null),eX=(0,n.useRef)(null),eY=(0,n.useCallback)(async()=>{if(ew&&eb.current){if(eJ.current||(eJ.current=new(window.AudioContext||window.webkitAudioContext)),"suspended"===eJ.current.state)try{await eJ.current.resume()}catch(e){console.warn("VoiceAgent: failed to resume audio context",e)}if(eq.current||(eq.current=eJ.current.createMediaStreamDestination()),eZ.current||(eZ.current=await navigator.mediaDevices.getUserMedia({audio:!0})),eZ.current&&!e$.current&&eq.current&&(e$.current=eJ.current.createMediaStreamSource(eZ.current),e$.current.connect(eq.current)),!eX.current&&eq.current&&(eX.current=eJ.current.createMediaElementSource(eb.current),eX.current.connect(eJ.current.destination),eX.current.connect(eq.current)),eq.current&&!ez.current){let e=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":"audio/webm";ez.current=new MediaRecorder(eq.current.stream,{mimeType:e}),ez.current.ondataavailable=e=>{if(e.data.size>0){eH.current.push(e.data);let t=Date.now();if(t-eW.current>3e4){if(eH.current.length>600){let e=eH.current.length-600;eH.current.splice(0,e),console.log("VoiceAgent: Cleaned up ".concat(e," old audio chunks to prevent memory bloat"))}eW.current=t}e3()}}}ez.current&&"inactive"===ez.current.state&&(eH.current=[],ez.current.start(1e3))}},[ew]),eQ=(0,n.useCallback)(async()=>{var e,t,r,a;if(!ew)return null;let n=null;if(ez.current&&"inactive"!==ez.current.state?n=await new Promise(e=>{let t=ez.current,r=()=>{t.removeEventListener("stop",r),e(new Blob(eH.current,{type:t.mimeType||"audio/webm"}))};t.addEventListener("stop",r),t.stop()}):eH.current.length>0&&(n=new Blob(eH.current,{type:(null==(a=ez.current)?void 0:a.mimeType)||"audio/webm"})),null==(e=eZ.current)||e.getTracks().forEach(e=>e.stop()),eZ.current=null,null==(t=e$.current)||t.disconnect(),e$.current=null,null==(r=eX.current)||r.disconnect(),eX.current=null,eq.current=null,ez.current=null,eH.current=[],eJ.current){try{await eJ.current.close()}catch(e){console.warn("VoiceAgent: failed to close audio context",e)}eJ.current=null}return n},[ew]),e0=(0,n.useCallback)(e=>new Promise((t,r)=>{let a=new FileReader;a.onloadend=()=>{"string"==typeof a.result?t(a.result):r(Error("Failed to read audio recording."))},a.onerror=()=>{var e;return r(null!=(e=a.error)?e:Error("Failed to read audio recording."))},a.readAsDataURL(e)}),[]),e1=(0,n.useCallback)(()=>{if(eH.current.length>0){var e;return new Blob(eH.current,{type:(null==(e=ez.current)?void 0:e.mimeType)||"audio/webm"})}return null},[]),e3=(0,n.useCallback)(async()=>{let e=e1();if(e)try{let t=await e0(e);ev(t)}catch(e){console.warn("Failed to update current recording:",e)}},[e1,e0]);(0,n.useEffect)(()=>{z(!0)},[]);let e4=(0,n.useCallback)(()=>{eE.current=[],eb.current&&(eb.current.pause(),eb.current.removeAttribute("src"),eb.current.currentTime=0),eS(null),eI(-1),"AI_SPEAKING"===s.current&&t("LISTENING")},[]),e5=(0,n.useCallback)(e=>{"AI_SPEAKING"===s.current&&e.trim().length>0&&e4(),J(e)},[e4]),e2=(0,n.useRef)(null),e6=(0,n.useRef)(null),e8=(0,n.useCallback)((e,t)=>{let r=e.play();r&&"function"==typeof r.catch&&r.catch(e=>{var r;(null==e?void 0:e.name)==="AbortError"||(null==e||null==(r=e.message)?void 0:r.includes("The play() request was interrupted"))||t(e)})},[]),e9=(0,n.useCallback)((e,r)=>{eb.current&&(eE.current=[],eb.current.pause(),eb.current.src=e,eb.current.currentTime=0,eI(-1),eS(r),t("AI_SPEAKING"),e8(eb.current,e=>{console.error("VoiceAgent: playback failed",e),t("LISTENING")}))},[e8]),e7=(0,n.useCallback)(async e=>{if("LISTENING"!==s.current&&"AI_SPEAKING"!==s.current)return;let t=e.trim();J("");let r=t?{id:"user-".concat(Date.now()),speaker:"User",text:t,timestamp:new Date().toISOString()}:null,a=r?[...eu,r]:eu;r&&ed(a),e6.current&&e6.current(a,t)},[eu]),{isRecording:te,startRecording:tt,stopRecording:tr}=(0,j.C)({onTranscriptionComplete:e7,onTranscribe:e5,silenceTimeout:30,inactivityTimeout:5e3}),ta=(0,n.useCallback)(async(e,r)=>{let a=null==e?void 0:e.trim();if(!a)return void t("LISTENING");t("AI_SPEAKING");try{ew&&await eY();let e=a.replace(/\bET\b/g,"E T"),n=performance.now(),s=await (0,E.T)({text:e,voice:eL}),c=performance.now();console.log("VoiceAgent: TTS synthesis completed in ".concat((c-n).toFixed(2),"ms for ").concat(e.length," characters"));let l=s.audioDataUri;if(ed(e=>e.map(e=>e.id===r?{...e,audioDataUri:l}:e)),eb.current){eE.current=[],eS(r),eI(-1);try{eJ.current&&"suspended"===eJ.current.state&&await eJ.current.resume()}catch(e){console.warn("VoiceAgent: failed to resume audio context before playback",e)}eb.current.pause(),eb.current.src=l,eb.current.currentTime=0,e8(eb.current,e=>{console.error("Audio playback error:",e),eR({variant:"destructive",title:"Playback Error",description:"Could not play audio: ".concat(e.message)}),t("LISTENING")})}else t("LISTENING")}catch(e){console.error("TTS synthesis error:",e),eR({variant:"destructive",title:"TTS Error",description:e.message}),t("LISTENING")}},[eL,eR,ew,eY,e8]),tn=(0,n.useRef)(0);e6.current=(0,n.useCallback)(async(e,r)=>{let a=performance.now();if(console.log("VoiceAgent: Starting agent turn processing at ".concat(new Date().toISOString())),!Q||!ei||!et)return;ep(null),t("PROCESSING");let n=(()=>{let t=eK.current,r=e_.map(e=>"".concat(e.id,"-").concat(e.name,"-").concat(e.product,"-").concat(e.category)).join("|");if(t&&t.filesHash===r&&t.productName===et.name&&t.cohort===ei)return t.context;let a=_(e_,et,e,ei);return eK.current={filesHash:r,productName:et.name,cohort:ei,context:a},a})();try{let a={action:"PROCESS_USER_RESPONSE",product:Q,productDisplayName:et.displayName,brandName:et.brandName,salesPlan:er,specialPlanConfigurations:en,offer:ec,customerCohort:ei,agentName:H,userName:Z,knowledgeBaseContext:n,conversationHistory:e,currentPitchState:eh,currentUserInputText:r,inactivityCounter:tn.current,brandUrl:et.brandUrl},c=await S(a);if(c.generatedPitch&&ef(c.generatedPitch),c.errorMessage)throw Error(c.errorMessage);r?tn.current=0:tn.current+=1;let l=c.currentAiResponseText;if(l){let e={id:"ai-".concat(Date.now()),speaker:"AI",text:l,timestamp:new Date().toISOString()};ed(t=>[...t,e]),"INTERACTION_ENDED"===c.nextExpectedAction&&(eT(!0),setTimeout(()=>{"ENDED"!==s.current&&e2.current&&e2.current()},500)),await ta(l,e.id)}else t("LISTENING")}catch(r){let e="I'm sorry, a critical system error occurred. Details: ".concat(r.message.substring(0,200),"..."),t={id:"error-".concat(Date.now()),speaker:"AI",text:e,timestamp:new Date().toISOString()};ed(e=>[...e,t]),ep(r.message),await ta(e,t.id)}let c=performance.now();console.log("VoiceAgent: Agent turn completed in ".concat((c-a).toFixed(2),"ms (").concat(e.length," turns in conversation)"))},[Q,et,H,Z,er,en,ec,ei,eh,e_,eR,ta]);let ts=(0,n.useCallback)(async e=>{let{transcript:t,audioDataUri:a,transcriptAccuracy:n}=e;if(!t||!Q||0===t.trim().length){console.warn("VoiceAgent: Skipping scoring - no valid transcript provided"),eR({variant:"destructive",title:"Scoring Skipped",description:"No valid transcript available for scoring."});return}if(!t.includes("AGENT (Profile:")||!t.includes("USER (Profile:")){console.warn("VoiceAgent: Skipping scoring - transcript format invalid for scoring"),eR({variant:"destructive",title:"Scoring Skipped",description:"Transcript format is not compatible with scoring system."});return}let{scoreCall:s}=await r.e(6933).then(r.bind(r,16933));try{let e=Y(Q);if(!e)throw Error("Product details not found for scoring.");let r=(()=>{let t=eK.current,r=e_.map(e=>"".concat(e.id,"-").concat(e.name,"-").concat(e.product,"-").concat(e.category)).join("|");if(t&&t.filesHash===r&&t.productName===e.name&&t.cohort===(ei||""))return t.context;let a=_(e_,e,[],ei);return eK.current={filesHash:r,productName:e.name,cohort:ei||"",context:a},a})(),c=await s({product:Q,agentName:H,audioDataUri:a,transcriptOverride:t,productContext:r,brandUrl:e.brandUrl});if(eg(e=>e?{...e,transcript:t,transcriptAccuracy:n,audioUri:a,score:c}:{transcript:t,transcriptAccuracy:n,audioUri:a,score:c}),eU.current){let e=eP.find(e=>e.id===eU.current);e&&eD(eU.current,{...e.details,finalScore:c})}eR({title:"Scoring Complete!",description:"The call has been scored successfully."})}catch(e){eR({variant:"destructive",title:"Scoring Failed",description:e.message})}},[Q,ei,Y,e_,H,eD,eR,eP]),tc=(0,n.useCallback)(async function(){let e,r,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Completed";e2.current=tc,tr(),e4(),t("PROCESSING");try{let t=await eQ();t&&t.size>0&&(e=await e0(t))}catch(e){console.warn("VoiceAgent: failed to capture live recording, falling back to synthesis",e)}if(!e)try{let t=await (0,C.R)({conversationHistory:eu,agentVoiceProfile:eL});t.audioDataUri?e=t.audioDataUri:t.errorMessage&&eR({variant:"destructive",title:"Audio Generation Failed",description:t.errorMessage})}catch(e){eR({variant:"destructive",title:"Audio Generation Error",description:e.message})}let n=eu.map(e=>"".concat(K(e.speaker)," (Profile: ").concat(K(e.speaker),"): ").concat(e.text)).join("\n");if(e)try{let t=await fetch("/api/transcription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audioDataUri:e})});if(t.ok){let e=(await t.json()).segments.map(e=>"".concat(e.speaker," (Profile: ").concat(e.speakerProfile,"): ").concat(e.text)).join("\n");e&&(n=e),r="Completed"}}catch(e){console.warn("VoiceAgent: transcription failed, using fallback transcript",e)}if(eg({transcript:n,transcriptAccuracy:r,audioUri:e}),eU.current){let t=eP.find(e=>e.id===eU.current);t&&eD(eU.current,{...t.details,status:a,fullTranscriptText:n,fullConversation:eu,fullCallAudioDataUri:e,selectedKbIds:e_.map(e=>e.id)})}t("ENDED"),"Completed"===a&&setTimeout(()=>{ts({transcript:n,audioDataUri:e,transcriptAccuracy:r})},100)},[eu,tr,e4,eQ,e0,C.R,eL,eR,eP,eD,e_,ts]),tl=(0,n.useCallback)(async()=>{if(!Z.trim()||!H.trim()||!Q||!ei||!et)return void eR({variant:"destructive",title:"Missing Info",description:"Agent Name, Customer Name, Product, and Cohort are required."});0===e_.length&&eR({title:"No Knowledge Base Files",description:"There are no KB files for '".concat(et.displayName,"'. The AI will rely on its general knowledge."),duration:6e3}),tn.current=0,ed([]),ef(null),eg(null),t("PROCESSING");let e={input:{product:Q,customerCohort:ei,agentName:H,userName:Z,voiceName:eL,selectedKbIds:e_.map(e=>e.id)},status:"In Progress"};eU.current=ek({module:"Browser Voice Agent",product:Q,details:e});try{ew&&await eY();let e=(()=>{let e=eK.current,t=e_.map(e=>"".concat(e.id,"-").concat(e.name,"-").concat(e.product,"-").concat(e.category)).join("|");if(e&&e.filesHash===t&&e.productName===et.name&&e.cohort===ei)return e.context;let r=_(e_,et,[],ei);return eK.current={filesHash:t,productName:et.name,cohort:ei,context:r},r})(),t={action:"START_CONVERSATION",product:Q,productDisplayName:et.displayName,brandName:et.brandName,salesPlan:er,specialPlanConfigurations:en,offer:ec,customerCohort:ei,agentName:H,userName:Z,knowledgeBaseContext:e,conversationHistory:[],currentPitchState:null,brandUrl:et.brandUrl},r=await S(t);if(r.errorMessage||!r.generatedPitch||!r.currentAiResponseText)throw Error(r.errorMessage||"Failed to generate initial pitch.");ef(r.generatedPitch);let a=r.currentAiResponseText,n={id:"ai-".concat(Date.now()),speaker:"AI",text:a,timestamp:new Date().toISOString()};ed([n]),await ta(a,n.id)}catch(a){let e=a.message||"Failed to start conversation.";ep(e),t("ERROR");let r={id:"error-".concat(Date.now()),speaker:"AI",text:e,timestamp:new Date().toISOString()};ed(e=>[...e,r]),ew&&await eQ()}},[Z,H,Q,et,ei,eL,er,en,ec,ek,eR,e_,ta,ew,eY,eQ]),ti=(0,n.useCallback)(async()=>{let e=new Audio;e.onended=()=>eB(!1),e.onpause=()=>eB(!1),e.onerror=()=>{eR({variant:"destructive",title:"Audio Playback Error"}),eB(!1)},eB(!0);try{let t=b.R.replace(/\bET\b/g,"E T");e.src=(await (0,E.T)({text:t,voice:eL})).audioDataUri;let r=e.play();r&&"function"==typeof r.catch&&r.catch(e=>{var t;(null==e?void 0:e.name)==="AbortError"||(null==e||null==(t=e.message)?void 0:t.includes("The play() request was interrupted"))||(eR({variant:"destructive",title:"Audio Playback Error",description:null==e?void 0:e.message}),eB(!1))})}catch(e){eR({variant:"destructive",title:"TTS Error",description:e.message}),eB(!1)}},[eL,eR]),to=(0,n.useCallback)(()=>{if(eU.current&&"CONFIGURING"!==s.current){let e=Array.isArray(eu)?eu:[],t=eP.find(e=>e.id===eU.current);t&&eD(eU.current,{...t.details,status:"Completed (Reset)",fullTranscriptText:e.map(e=>"".concat(K(e.speaker),": ").concat(e.text)).join("\n"),fullConversation:e}),eR({title:"Interaction Logged",description:"The previous call was logged before resetting."})}t("CONFIGURING"),ed([]),ef(null),eg(null),ep(null),eU.current=null,J(""),e4(),tr(),ew&&eQ().catch(()=>{})},[e4,eu,eD,eR,tr,eQ,ew,eP]);(0,n.useEffect)(()=>{eG.current&&eG.current.scrollIntoView({behavior:"smooth"})},[eu,y]),(0,n.useEffect)(()=>{let e=eb.current,r=()=>{if(eE.current.length>0){let r=eE.current.shift();e.pause(),e.src=r,e.currentTime=0,e8(e,e=>{console.error("Audio playback error in queue:",e),t("LISTENING")})}else eS(null),eI(-1),eA?(e2.current&&e2.current(),eT(!1)):"AI_SPEAKING"===s.current&&t("LISTENING")},a=()=>{if(!e||e.paused||!ey||!isFinite(e.duration)||e.duration<=0)return;let t=eu.find(e=>e.id===ey);if(!t)return;let r=t.text.trim().split(/\s+/).filter(Boolean).length;if(0===r)return;let a=Math.floor(Math.min(Math.max(e.currentTime/e.duration,0),1)*(r-1));eI(e=>e===a?e:a)};return e&&(e.addEventListener("ended",r),e.addEventListener("timeupdate",a)),()=>{e&&(e.removeEventListener("ended",r),e.removeEventListener("timeupdate",a))}},[eu,ey,eA,e8]),(0,n.useEffect)(()=>{"LISTENING"!==e||te?"LISTENING"!==e&&te&&tr():tt()},[e,te,tt,tr]),(0,n.useEffect)(()=>{let e=e=>{eV&&eU.current&&e2.current&&e2.current("Completed (Page Unloaded)")};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[eV]);let tu=(0,n.useMemo)(()=>(null==et?void 0:et.customerCohorts)||[],[et]),td=(0,n.useMemo)(()=>(null==et?void 0:et.salesPlans)||[],[et]),tm=(0,n.useMemo)(()=>(null==et?void 0:et.specialPlanConfigurations)||[],[et]);return(0,n.useEffect)(()=>{et&&tu.length>0&&!tu.includes(ei||"")&&eo(tu[0])},[et,tu,ei]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("audio",{ref:eb,className:"hidden"}),(0,a.jsx)("audio",{ref:ej,className:"hidden"}),(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)(c.z,{title:"AI Voice Sales Agent"}),(0,a.jsxs)("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-6",children:[(0,a.jsxs)(i.Zp,{className:"w-full max-w-4xl mx-auto",children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsxs)(i.ZB,{className:"text-xl flex items-center",children:[(0,a.jsx)(k.A,{className:"mr-2 h-6 w-6 text-primary"})," Configure AI Voice Call"]}),(0,a.jsx)(i.BT,{children:"Set up agent, customer, product, and voice profile details before starting the call. The entire Knowledge Base for the selected product will be used as context."})]}),(0,a.jsxs)(i.Wu,{children:[(0,a.jsx)(V.nD,{type:"single",collapsible:!0,defaultValue:"CONFIGURING"===e?"item-config":"",className:"w-full",children:(0,a.jsxs)(V.As,{value:"item-config",children:[(0,a.jsx)(V.$m,{className:"text-md font-semibold hover:no-underline py-2 text-foreground/90 [&[data-state=open]>&svg]:rotate-180",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(D.A,{className:"mr-2 h-4 w-4 text-accent"}),"Call Configuration"]})}),(0,a.jsxs)(V.ub,{className:"pt-3 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d.J,{children:"AI Voice Profile (Agent)"}),(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,a.jsxs)(o.l6,{value:eL,onValueChange:eF,disabled:eV,children:[(0,a.jsx)(o.bq,{className:"flex-grow",children:(0,a.jsx)(o.yv,{placeholder:"Select a voice"})}),(0,a.jsx)(o.gC,{children:b.U.map(e=>(0,a.jsx)(o.eb,{value:e.id,children:e.name},e.id))})]}),(0,a.jsx)(l.$,{variant:"outline",size:"sm",onClick:ti,disabled:eM||eV,children:eM?(0,a.jsx)(I.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(O.A,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)(d.J,{htmlFor:"product-select",children:["Product ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsxs)(o.l6,{value:Q,onValueChange:e=>ee(e),disabled:eV,children:[(0,a.jsx)(o.bq,{id:"product-select",children:(0,a.jsx)(o.yv,{placeholder:"Select a Product"})}),(0,a.jsx)(o.gC,{children:X.map(e=>(0,a.jsx)(o.eb,{value:e.name,children:e.displayName},e.name))})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)(d.J,{htmlFor:"cohort-select",children:["Customer Cohort ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsxs)(o.l6,{value:ei,onValueChange:e=>eo(e),disabled:eV||!et||0===tu.length,children:[(0,a.jsx)(o.bq,{id:"cohort-select",children:(0,a.jsx)(o.yv,{placeholder:"Select Cohort"})}),(0,a.jsx)(o.gC,{children:tu.map(e=>(0,a.jsx)(o.eb,{value:e,children:e},e))})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)(d.J,{htmlFor:"agent-name",children:["Agent Name ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsx)(u.p,{id:"agent-name",placeholder:"e.g., Samantha",value:H,onChange:e=>W(e.target.value),disabled:eV})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)(d.J,{htmlFor:"user-name",children:["Customer Name ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsx)(u.p,{id:"user-name",placeholder:"e.g., Rohan",value:Z,onChange:e=>$(e.target.value),disabled:eV})]})]}),q&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[tm.length>0&&(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d.J,{htmlFor:"special-plan-config-select",children:"Special Plan Configuration (Optional)"}),(0,a.jsxs)(o.l6,{value:en,onValueChange:e=>es(e),disabled:eV,children:[(0,a.jsx)(o.bq,{id:"special-plan-config-select",children:(0,a.jsx)(o.yv,{placeholder:"Select special config"})}),(0,a.jsx)(o.gC,{children:tm.map(e=>(0,a.jsx)(o.eb,{value:e,children:e},e))})]})]}),td.length>0&&(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d.J,{htmlFor:"plan-select",children:"Sales Plan (Optional)"}),(0,a.jsxs)(o.l6,{value:er,onValueChange:e=>ea(e),disabled:eV,children:[(0,a.jsx)(o.bq,{id:"plan-select",children:(0,a.jsx)(o.yv,{placeholder:"Select Sales Plan"})}),(0,a.jsx)(o.gC,{children:td.map(e=>(0,a.jsx)(o.eb,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d.J,{htmlFor:"offer-details",children:"Offer Details (Optional)"}),(0,a.jsx)(u.p,{id:"offer-details",placeholder:"e.g., 20% off",value:ec,onChange:e=>el(e.target.value),disabled:eV})]})]})]})]})}),"CONFIGURING"===e&&(0,a.jsxs)(l.$,{onClick:tl,disabled:!Q||!ei||!Z.trim()||!H.trim(),className:"w-full mt-4",children:[(0,a.jsx)(G.A,{className:"mr-2 h-4 w-4"})," Start Voice Call"]})]})]}),"CONFIGURING"!==e&&"IDLE"!==e&&(0,a.jsxs)(i.Zp,{className:"w-full max-w-4xl mx-auto mt-4",children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsxs)(i.ZB,{className:"text-lg flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(U.A,{className:"mr-2 h-5 w-5 text-primary"})," Conversation Log"]}),(()=>{switch(e){case"LISTENING":return(0,a.jsxs)(x.E,{variant:"default",className:"text-xs bg-green-100 text-green-800",children:[(0,a.jsx)(A.A,{className:"mr-1.5 h-3.5 w-3.5"}),"Listening..."]});case"AI_SPEAKING":return(0,a.jsxs)(x.E,{variant:"outline",className:"text-xs bg-amber-100 text-amber-800",children:[(0,a.jsx)(T.A,{className:"mr-1.5 h-3.5 w-3.5"}),"AI Speaking (Interruptible)"]});case"PROCESSING":return(0,a.jsxs)(x.E,{variant:"secondary",className:"text-xs",children:[(0,a.jsx)(I.A,{className:"mr-1.5 h-3.5 w-3.5 animate-spin"}),"Processing..."]});case"ENDED":return(0,a.jsxs)(x.E,{variant:"secondary",className:"text-xs bg-gray-200 text-gray-600",children:[(0,a.jsx)(R.A,{className:"mr-1.5 h-3.5 w-3.5"}),"Interaction Ended"]});case"ERROR":return(0,a.jsxs)(x.E,{variant:"destructive",className:"text-xs",children:[(0,a.jsx)(P.A,{className:"mr-1.5 h-3.5 w-3.5"}),"Error"]});default:return(0,a.jsx)(x.E,{variant:"outline",className:"text-xs",children:"Idle"})}})()]}),(0,a.jsxs)(i.BT,{children:["Interaction with ",Z||"Customer",". Agent: ",H||"Default AI",". Product: ",null==et?void 0:et.displayName,"."]})]}),(0,a.jsxs)(i.Wu,{children:[(0,a.jsxs)(p.F,{className:"h-[300px] w-full border rounded-md p-3 bg-muted/20 mb-3",children:[eu.map(e=>(0,a.jsx)(f.j,{turn:e,onPlayAudio:e9,currentlyPlayingId:ey,wordIndex:e.id===ey?eC:-1},e.id)),"LISTENING"===e&&(0,a.jsxs)("div",{className:"flex items-start gap-2.5 my-3 justify-end user-line",children:[(0,a.jsx)("div",{className:"flex flex-col gap-1 w-full max-w-[80%] items-end",children:(0,a.jsx)(i.Zp,{className:"max-w-full w-fit p-3 rounded-xl shadow-sm bg-accent/80 text-accent-foreground rounded-br-none",children:(0,a.jsx)(i.Wu,{className:"p-0 text-sm",children:(0,a.jsx)("p",{className:"italic",children:y||" Listening..."})})})}),(0,a.jsx)(M.eu,{className:"h-8 w-8 shrink-0",children:(0,a.jsx)(M.q5,{className:"bg-accent text-accent-foreground",children:(0,a.jsx)(L.A,{size:18})})})]}),"PROCESSING"===e&&(0,a.jsx)(h.k,{size:16,className:"mx-auto my-2"}),(0,a.jsx)("div",{ref:eG})]}),eN&&(0,a.jsxs)("div",{className:"mb-3 p-3 border rounded-md bg-muted/10",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(A.A,{className:"h-4 w-4 text-primary"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Live Call Recording"})]}),(0,a.jsx)("audio",{ref:ej,controls:!0,className:"w-full",src:eN}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Full call recording - you can seek, rewind, and fast-forward"})]}),em&&(0,a.jsx)(m.Fc,{variant:"destructive",className:"mb-3",children:(0,a.jsx)(V.nD,{type:"single",collapsible:!0,children:(0,a.jsxs)(V.As,{value:"item-1",className:"border-b-0",children:[(0,a.jsx)(V.$m,{className:"p-0 hover:no-underline text-sm font-semibold [&_svg]:ml-1",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(P.A,{className:"h-4 w-4 mr-2"})," An error occurred. Click to see details."]})}),(0,a.jsx)(V.ub,{className:"pt-2 text-xs",children:(0,a.jsx)("pre",{className:"whitespace-pre-wrap break-all bg-destructive/10 p-2 rounded-md font-mono",children:em})})]})})})]}),(0,a.jsxs)(i.wL,{className:"flex justify-between items-center",children:[(0,a.jsxs)(l.$,{onClick:()=>tc(),variant:"destructive",size:"sm",disabled:"ENDED"===e,children:[(0,a.jsx)(R.A,{className:"mr-2 h-4 w-4"})," End Interaction"]}),(0,a.jsxs)(l.$,{onClick:to,variant:"outline",size:"sm",children:[(0,a.jsx)(F.A,{className:"mr-2 h-4 w-4"})," New Call"]})]})]}),ex&&"ENDED"===e&&(0,a.jsx)(B,{artifacts:ex,agentName:H,userName:Z,product:Q})]})]})]})}},63075:(e,t,r)=>{Promise.resolve().then(r.bind(r,20711))}},e=>{e.O(0,[4909,6077,9972,6107,4037,2254,6402,2410,7380,1847,8441,1255,7358],()=>e(e.s=63075)),_N_E=e.O()}]);