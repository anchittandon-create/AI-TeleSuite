(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4260],{41052:(e,t,s)=>{"use strict";s.d(t,{C5:()=>j,MJ:()=>g,Rr:()=>f,eI:()=>h,lR:()=>p,lV:()=>o,zB:()=>m});var r=s(95155),a=s(12115),n=s(32467),l=s(22544),i=s(64269),c=s(76444);let o=l.Op,d=a.createContext({}),m=e=>{let{...t}=e;return(0,r.jsx)(d.Provider,{value:{name:t.name},children:(0,r.jsx)(l.xI,{...t})})},u=()=>{let e=a.useContext(d),t=a.useContext(x),{getFieldState:s,formState:r}=(0,l.xW)(),n=s(e.name,r);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...n}},x=a.createContext({}),h=a.forwardRef((e,t)=>{let{className:s,...n}=e,l=a.useId();return(0,r.jsx)(x.Provider,{value:{id:l},children:(0,r.jsx)("div",{ref:t,className:(0,i.cn)("space-y-2",s),...n})})});h.displayName="FormItem";let p=a.forwardRef((e,t)=>{let{className:s,...a}=e,{error:n,formItemId:l}=u();return(0,r.jsx)(c.J,{ref:t,className:(0,i.cn)(n&&"text-destructive",s),htmlFor:l,...a})});p.displayName="FormLabel";let g=a.forwardRef((e,t)=>{let{...s}=e,{error:a,formItemId:l,formDescriptionId:i,formMessageId:c}=u();return(0,r.jsx)(n.DX,{ref:t,id:l,"aria-describedby":a?"".concat(i," ").concat(c):"".concat(i),"aria-invalid":!!a,...s})});g.displayName="FormControl";let f=a.forwardRef((e,t)=>{let{className:s,...a}=e,{formDescriptionId:n}=u();return(0,r.jsx)("p",{ref:t,id:n,className:(0,i.cn)("text-sm text-muted-foreground",s),...a})});f.displayName="FormDescription";let j=a.forwardRef((e,t)=>{var s;let{className:a,children:n,...l}=e,{error:c,formMessageId:o}=u(),d=c?String(null!=(s=null==c?void 0:c.message)?s:""):n;return d?(0,r.jsx)("p",{ref:t,id:o,className:(0,i.cn)("text-sm font-medium text-destructive",a),...l,children:d}):null});j.displayName="FormMessage"},58347:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>J,maxDuration:()=>M});var r=s(95155),a=s(12115),n=s(66942),l=s(22544),i=s(98734),c=s(3998),o=s(41052),d=s(65142),m=s(11186),u=s(86948),x=s(74421),h=s(31524);let p=i.Ik({audioFiles:i.Ie(e=>e instanceof FileList&&e.length>0,"Please select at least one audio file.").refine(e=>!e||0===e.length||Array.from(e).every(e=>e.size<=0x6400000),{message:"One or more files exceed the ".concat(100,"MB limit.")}),agentName:i.Yj().optional(),product:i.Yj().min(1,"Product must be selected.")});function g(e){let{onSubmit:t,isLoading:s}=e,{availableProducts:i}=(0,h.G)(),g=a.useRef(null),f=(0,l.mN)({resolver:(0,n.u)(p),defaultValues:{agentName:"",product:""}});return(0,r.jsxs)(u.Zp,{className:"w-full max-w-lg shadow-lg",children:[(0,r.jsxs)(u.aR,{children:[(0,r.jsxs)(u.ZB,{className:"text-xl flex items-center",children:[(0,r.jsx)(x.A,{className:"mr-2 h-6 w-6 text-primary"}),"Score Call(s)"]}),(0,r.jsx)(u.BT,{children:"Upload audio files to score them against a product's context. The AI analyzes both the audio tone and the transcribed content."})]}),(0,r.jsx)(u.Wu,{children:(0,r.jsx)(o.lV,{...f,children:(0,r.jsxs)("form",{onSubmit:f.handleSubmit(e=>{t(e)}),className:"space-y-6",children:[(0,r.jsx)(o.zB,{control:f.control,name:"product",render:e=>{let{field:t}=e;return(0,r.jsxs)(o.eI,{children:[(0,r.jsxs)(o.lR,{children:["Product Focus ",(0,r.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,r.jsxs)(m.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,r.jsx)(o.MJ,{children:(0,r.jsx)(m.bq,{children:(0,r.jsx)(m.yv,{placeholder:"Select a product for context"})})}),(0,r.jsx)(m.gC,{children:i.map(e=>(0,r.jsx)(m.eb,{value:e.name,children:e.displayName},e.name))})]}),(0,r.jsx)(o.C5,{})]})}}),(0,r.jsx)(o.zB,{control:f.control,name:"agentName",render:e=>{let{field:t}=e;return(0,r.jsxs)(o.eI,{children:[(0,r.jsx)(o.lR,{children:"Agent Name (Optional)"}),(0,r.jsx)(o.MJ,{children:(0,r.jsx)(d.p,{placeholder:"Enter agent name",...t})}),(0,r.jsx)(o.C5,{})]})}}),(0,r.jsx)(o.zB,{control:f.control,name:"audioFiles",render:e=>{let{field:t}=e;return(0,r.jsxs)(o.eI,{children:[(0,r.jsxs)(o.lR,{children:["Audio File(s) ",(0,r.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,r.jsx)(o.MJ,{children:(0,r.jsx)(d.p,{type:"file",accept:"audio/*",multiple:!0,ref:g,onChange:e=>t.onChange(e.target.files),className:"pt-1.5"})}),(0,r.jsxs)(o.Rr,{children:["Select one or more audio files (max ",100,"MB each). Tonality and content will be analyzed."]}),(0,r.jsx)(o.C5,{})]})}}),(0,r.jsx)(c.$,{type:"submit",className:"w-full",disabled:s,children:s?"Processing...":"Score Call(s)"})]})})})]})}var f=s(87270),j=s(51834),N=s(17037),v=s(11647),w=s(92649),b=s(62593),y=s(92033),S=s(18527),C=s(60406),A=s(36654),E=s(40710);function F(e){let{results:t}=e,[s,n]=(0,a.useState)(null),[l,i]=(0,a.useState)(!1),o=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=[],a=t?"h-3.5 w-3.5":"h-5 w-5";for(let t=1;t<=5;t++)e>=t?s.push((0,r.jsx)(w.A,{className:"".concat(a," text-yellow-400 fill-yellow-400")},t)):s.push((0,r.jsx)(w.A,{className:"".concat(a," text-muted-foreground/50")},t));return s};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"w-full max-w-5xl mt-8 shadow-lg rounded-lg border bg-card",children:[(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-primary",children:"Scoring Results"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Results for ",t.length," item(s)."]})]}),(0,r.jsx)(N.F,{className:"h-[calc(100vh-450px)] md:h-[600px]",children:(0,r.jsxs)(f.XI,{children:[(0,r.jsx)(f.A0,{className:"sticky top-0 bg-muted/50 backdrop-blur-sm z-10",children:(0,r.jsxs)(f.Hj,{children:[(0,r.jsx)(f.nd,{className:"w-[50px]",children:"SNo."}),(0,r.jsx)(f.nd,{children:"File Name / Source"}),(0,r.jsx)(f.nd,{className:"text-center w-[150px]",children:"Overall Score"}),(0,r.jsx)(f.nd,{className:"text-center w-[150px]",children:"Categorization"}),(0,r.jsx)(f.nd,{className:"text-center w-[200px]",children:"Status"}),(0,r.jsx)(f.nd,{className:"text-right w-[150px]",children:"Actions"})]})}),(0,r.jsx)(f.BF,{children:0===t.length?(0,r.jsx)(f.Hj,{children:(0,r.jsx)(f.nA,{colSpan:6,className:"h-24 text-center text-muted-foreground",children:"No call scoring jobs initiated yet."})}):t.map((e,t)=>{let s=e.details.scoreOutput,a=null==s?void 0:s.overallScore,l=null==s?void 0:s.callCategorisation;return(0,r.jsxs)(f.Hj,{children:[(0,r.jsx)(f.nA,{children:t+1}),(0,r.jsx)(f.nA,{className:"font-medium max-w-xs truncate",title:e.details.fileName,children:e.details.fileName}),(0,r.jsx)(f.nA,{className:"text-center",children:s&&"number"==typeof a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex items-center justify-center gap-1",title:"".concat(a.toFixed(1),"/5"),children:o(a,!0)}),(0,r.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",a.toFixed(1),"/5)"]})]}):"..."}),(0,r.jsx)(f.nA,{className:"text-center",children:l?(0,r.jsx)(v.E,{variant:(e=>{if(!e)return"secondary";switch(e.toLowerCase()){case"excellent":return"default";case"good":default:return"secondary";case"average":return"outline";case"needs improvement":case"poor":case"error":return"destructive"}})(l),className:"text-xs",children:l}):"..."}),(0,r.jsx)(f.nA,{className:"text-center text-xs",title:e.details.status,children:(e=>{let t=e.details.status;switch(t){case"Queued":return(0,r.jsxs)(v.E,{variant:"outline",className:"text-xs",children:[(0,r.jsx)(b.A,{className:"mr-1 h-3 w-3"})," Queued"]});case"Transcribing":case"Scoring":return(0,r.jsxs)(v.E,{variant:"secondary",className:"text-xs",children:[(0,r.jsx)(y.A,{className:"mr-1 h-3 w-3 animate-spin"})," ",t,"..."]});case"Complete":return(0,r.jsxs)(v.E,{variant:"secondary",className:"text-xs bg-green-100 text-green-700 border-green-300",children:[(0,r.jsx)(S.A,{className:"mr-1 h-3 w-3"})," Complete"]});case"Failed":return(0,r.jsxs)(v.E,{variant:"destructive",className:"cursor-pointer text-xs",title:e.details.error,children:[(0,r.jsx)(C.A,{className:"mr-1 h-3 w-3"})," Failed"]});default:return(0,r.jsxs)(v.E,{variant:"outline",className:"text-xs",children:["Unknown (",t,")"]})}})(e)}),(0,r.jsx)(f.nA,{className:"text-right space-x-1",children:(0,r.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>{n(e),i(!0)},title:"View Full Scoring Report",disabled:!e.details.scoreOutput,children:[(0,r.jsx)(A.A,{className:"mr-1.5 h-4 w-4"})," Details"]})})]},e.id)})})]})})]}),s&&(0,r.jsx)(j.lG,{open:l,onOpenChange:i,children:(0,r.jsxs)(j.Cf,{className:"sm:max-w-2xl md:max-w-3xl lg:max-w-4xl min-h-[70vh] max-h-[85vh] flex flex-col p-0",children:[(0,r.jsxs)(j.c7,{className:"p-6 pb-2 border-b",children:[(0,r.jsx)(j.L3,{className:"text-xl text-primary",children:"Detailed Call Scoring Report"}),(0,r.jsxs)(j.rr,{children:["File: ",s.details.fileName]})]}),(0,r.jsx)(N.F,{className:"flex-grow overflow-y-auto",children:(0,r.jsx)("div",{className:"p-6",children:s.details.scoreOutput?(0,r.jsx)(E.o,{results:s.details.scoreOutput,fileName:s.details.fileName,agentName:s.agentName,product:s.product,audioDataUri:s.details.audioDataUri,isHistoricalView:!0}):(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center text-center p-8",children:[(0,r.jsx)(C.A,{className:"h-10 w-10 text-destructive mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Report Not Available"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mt-2",children:["The job status is '",s.details.status,"'. A detailed report can only be viewed once the job is complete."]}),s.details.error&&(0,r.jsxs)("div",{className:"mt-4 text-left",children:[(0,r.jsx)("p",{className:"font-semibold",children:"Error Details:"}),(0,r.jsx)("pre",{className:"text-xs bg-destructive/10 text-destructive-foreground p-2 rounded-md whitespace-pre-wrap",children:s.details.error})]})]})})}),(0,r.jsx)(j.Es,{className:"p-4 border-t bg-muted/50",children:(0,r.jsx)(c.$,{onClick:()=>i(!1),children:"Close"})})]})})]})}var T=s(65363),O=s(18332),I=s(7545),R=s(15894),D=s(79313),P=s(36950),U=s(14482),k=s(64201),B=s(39437),L=s(13496),z=s(17242);let M=300;function J(){let[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(!1),[l,i]=(0,a.useState)(null),{toast:c}=(0,R.dj)(),{logBatchActivities:o}=(0,D.Z)(),{getProductByName:d}=(0,h.G)(),{files:m}=(0,B.J)(),p=(0,a.useId)(),[f,j]=(0,a.useState)(0),[N,v]=(0,a.useState)(0),[w,b]=(0,a.useState)(""),[y,S]=(0,a.useState)([]),C=(e,t)=>{S(s=>{let r=s.findIndex(t=>t.id===e);if(-1===r)return s;let a=[...s];return a[r]={...a[r],...t},a})},A=async e=>{n(!0),i(null),t([]),S([]);let s=e.product;if(!s){i("Product selection is required."),n(!1);return}let r=d(s);if(!r){i("Selected product could not be found in the catalog."),n(!1);return}let a=((e,t)=>{if(!e||!Array.isArray(t))return"No product or knowledge base provided.";let s=t.filter(t=>t.product===e.name),r="--- START OF KNOWLEDGE BASE CONTEXT FOR PRODUCT: ".concat(e.displayName," ---\n");r+="Brand Name: ".concat(e.brandName||"Not provided","\n"),r+="Brand URL: ".concat(e.brandUrl||"Not provided","\n"),r+="Description: ".concat(e.description||"Not provided","\n"),r+="--------------------------------------------------\n\n";let a=(e,t)=>{t.length>0&&(r+="--- ".concat(e.toUpperCase()," ---\n"),t.forEach(e=>{let t="\n--- Item: ".concat(e.name," ---\n");e.isTextEntry&&e.textContent?t+="Content:\n".concat(e.textContent,"\n"):t+="(This is a reference to a ".concat(e.type," file named '").concat(e.name,"'. The AI should infer context from its name, type, and category.)\n"),r.length+t.length<=3e4&&(r+=t)}),r+="--- END ".concat(e.toUpperCase()," ---\n\n"))},n=s.filter(e=>"Pitch"===e.category),l=s.filter(e=>"Product Description"===e.category),i=s.filter(e=>"Pricing"===e.category),c=s.filter(e=>"Rebuttals"===e.category),o=s.filter(e=>!e.category||!["Pitch","Product Description","Pricing","Rebuttals"].includes(e.category));return a("PRODUCT DETAILS, FEATURES, & PRICING (Source for factual information)",[...l,...i]),a("COMMON OBJECTIONS & REBUTTALS (Source for handling objections)",c),a("PITCH & SALES FLOW CONTEXT (Source for call structure and narrative)",n),a("GENERAL SUPPLEMENTARY CONTEXT",o),r.length>=3e4&&(console.warn("Knowledge base context truncated due to length limit."),r+="\n... (Knowledge Base truncated due to length limit for AI context)\n"),(r+="--- END OF KNOWLEDGE BASE CONTEXT ---").substring(0,3e4)})(r,m),l=[];if(e.audioFiles&&e.audioFiles.length>0)for(let t of Array.from(e.audioFiles)){if(t.size>0x6400000){i('File "'.concat(t.name,'" exceeds the 100MB limit.')),n(!1);return}let e=await (0,U.zM)(t);l.push({name:t.name,audioDataUri:e})}else{i("Please provide at least one audio file to analyze."),n(!1);return}v(l.length);let u=l.map((t,r)=>({id:"".concat(p,"-").concat(t.name,"-").concat(r),timestamp:new Date().toISOString(),module:"Call Scoring",product:s,agentName:e.agentName,details:{fileName:t.name,status:"Queued",audioDataUri:t.audioDataUri}}));t(u),S(u.map(e=>({id:e.id,fileName:e.details.fileName,step:"Queued",status:"queued",progress:0,message:"Waiting to start transcription"})));let x=[];for(let n=0;n<l.length;n++){var h,g,f;let i,o=l[n],d="".concat(p,"-").concat(o.name,"-").concat(n),m=null,u=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(t=>t.map(t=>t.id===d?{...t,details:{...t.details,...s,status:e}}:t))};j(n+1),C(d,{step:"Transcribing audio",status:"running",progress:20,message:"Uploading audio & requesting transcript"});try{b("Transcribing..."),u("Transcribing");let t=await fetch("/api/transcription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audioDataUri:o.audioDataUri})});if(!t.ok)throw Error("Transcription API failed");let n=await t.json(),l=n.segments.map(e=>"[".concat(e.startSeconds.toFixed(1),"s - ").concat(e.endSeconds.toFixed(1),"s]\n").concat(e.speaker," (").concat(e.speakerProfile,"): ").concat(e.text)).join("\n\n"),i=n.summary.overview.includes("Error")?"Error":"High";if(C(d,{step:"Analyzing transcript",status:"running",progress:55,message:"Transcription complete, preparing scoring request"}),"Error"===i||l.includes("[Critical Transcription System Error"))throw Error("Transcription failed: ".concat(l));if(b("Scoring..."),u("Scoring"),m=await (0,k.t)({product:s,agentName:e.agentName,audioDataUri:o.audioDataUri,transcriptOverride:l,productContext:a,brandUrl:r.brandUrl}),C(d,{step:"Scoring insights",status:"running",progress:85,message:"Aggregating rubric scores and insights"}),m)m.transcript=l,m.transcriptAccuracy=i;else throw Error("Scoring function returned undefined result");if("Error"===m.callCategorisation)throw Error(m.summary);u("Complete",{scoreOutput:m}),C(d,{step:"Completed",status:"success",progress:100,message:"Overall score: ".concat((null==(g=m.overallScore)||null==(h=g.toFixed)?void 0:h.call(g,1))||m.overallScore)})}catch(r){i=r.message||"An unexpected error occurred.",m={transcript:(null==(f=r.message)?void 0:f.includes("Transcription failed:"))?r.message:"[Error processing ".concat(o.name,". Raw Error: ").concat(i,"]"),transcriptAccuracy:"System Error",overallScore:0,callCategorisation:"Error",summary:"Processing failed: ".concat(i),strengths:[],areasForImprovement:["Investigate and resolve the processing error."],redFlags:["System-level error during processing: ".concat((null==i?void 0:i.substring(0,100))||"Unknown error","...")],metricScores:[],improvementSituations:[],conversionReadiness:"Low",suggestedDisposition:"Error"},u("Failed",{error:i,scoreOutput:m}),C(d,{step:"Failed",status:"failed",progress:100,message:i});let t=(i||"").toLowerCase();if(t.includes("429")||t.includes("quota")||t.includes("rate limit")){c({variant:"destructive",title:"API Rate Limit Reached",description:"The AI is busy or the daily quota has been met. Stopping batch.",duration:7e3}),x.push({id:d,module:"Call Scoring",product:s,agentName:e.agentName,timestamp:new Date().toISOString(),details:{fileName:o.name,status:"Failed",agentNameFromForm:e.agentName,scoreOutput:m,error:i}});break}}finally{x.push({id:d,module:"Call Scoring",product:s,agentName:e.agentName,timestamp:new Date().toISOString(),details:{fileName:o.name,status:i?"Failed":"Complete",agentNameFromForm:e.agentName,scoreOutput:m,error:i||void 0}})}}x.length>0&&o(x),n(!1),b(""),c({title:"All jobs finished or stopped",description:"Finished processing all submitted item(s). Check table for results."})};return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)(P.z,{title:"AI Call Scoring"}),(0,r.jsxs)("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 flex flex-col items-center space-y-6",children:[y.length>0&&(0,r.jsx)(z.c,{items:y,description:"Each file moves through transcription and scoring steps."}),(0,r.jsx)(g,{onSubmit:A,isLoading:s}),s&&(0,r.jsxs)("div",{className:"mt-4 flex flex-col items-center gap-2",children:[(0,r.jsx)(T.k,{size:32}),(0,r.jsx)("p",{className:"text-muted-foreground",children:N>1?"Processing ".concat(f," of ").concat(N,": ").concat(w):"".concat(w||"Processing...")})]}),l&&!s&&(0,r.jsxs)(O.Fc,{variant:"destructive",className:"mt-4 max-w-lg",children:[(0,r.jsx)(I.A,{className:"h-4 w-4"}),(0,r.jsx)(O.XL,{children:"An Error Occurred"}),(0,r.jsx)(L.nD,{type:"single",collapsible:!0,className:"w-full",children:(0,r.jsxs)(L.As,{value:"item-1",className:"border-b-0",children:[(0,r.jsx)(L.$m,{className:"p-0 hover:no-underline text-sm [&_svg]:ml-1",children:"A validation error occurred. Click to view details."}),(0,r.jsx)(L.ub,{className:"pt-2",children:(0,r.jsx)("pre",{className:"text-xs whitespace-pre-wrap break-all bg-destructive/10 p-2 rounded-md font-mono",children:l})})]})})]}),e.length>0&&(0,r.jsx)(F,{results:e}),0===e.length&&!s&&!l&&(0,r.jsxs)(u.Zp,{className:"w-full max-w-lg shadow-sm",children:[(0,r.jsx)(u.aR,{children:(0,r.jsxs)(u.ZB,{className:"text-lg flex items-center",children:[(0,r.jsx)(x.A,{className:"h-5 w-5 mr-2 text-accent"}),"How to Use AI Call Scoring"]})}),(0,r.jsxs)(u.Wu,{className:"text-sm text-muted-foreground space-y-2",children:[(0,r.jsx)("p",{children:"1. Upload one or more audio files (up to 100MB each). The system will process them one by one."}),(0,r.jsxs)("p",{children:["2. Select a ",(0,r.jsx)("strong",{children:"Product Focus"}),". The AI uses the product's description and its linked Knowledge Base entries as context for scoring."]}),(0,r.jsxs)("p",{children:["3. Optionally, enter the ",(0,r.jsx)("strong",{children:"Agent Name"}),"."]}),(0,r.jsx)("div",{children:(0,r.jsxs)("p",{children:["4. Click ",(0,r.jsx)("strong",{children:"Score Call(s)"}),". The process will start immediately. The AI will first transcribe the audio and then score it based on both the content and tonality. Please wait for it to complete. For large files, this may take a few minutes."]})})]})]})]})]})}},97510:(e,t,s)=>{Promise.resolve().then(s.bind(s,58347))}},e=>{e.O(0,[2581,3930,5033,4909,6077,9972,6107,8458,4037,312,2254,6241,4589,2558,6414,6942,1350,2410,7380,2535,710,696,8441,1255,7358],()=>e(e.s=97510)),_N_E=e.O()}]);