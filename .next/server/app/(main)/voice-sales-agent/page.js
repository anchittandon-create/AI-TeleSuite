(()=>{var a={};a.id=5031,a.ids=[5031],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},643:a=>{"use strict";a.exports=require("node:perf_hooks")},1708:a=>{"use strict";a.exports=require("node:process")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:a=>{"use strict";a.exports=require("node:buffer")},7252:a=>{"use strict";a.exports=require("express")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11648:(a,b,c)=>{"use strict";c.d(b,{q:()=>m});var d=c(91488);c(27806);var e=c(38710),f=c(56571),g=c(87603),h=c(40410);let i=`You are a world-class sales agent. Your goal is to be empathetic, persuasive, and clear, using the provided KB to drive conversion. Your responses must be of the absolute highest quality.

**CRITICAL DIRECTIVE: You MUST base your entire response *exclusively* on the information provided in the structured 'Knowledge Base Context' section below. If a 'USER-SELECTED KB CONTEXT' section is present, it is your PRIMARY source of truth and MUST be prioritized over the general KB.**
**If the provided Knowledge Base is insufficient or lacks specific details, you are authorized to supplement your response by browsing the official product website ({{{brandUrl}}}) and its sub-pages to gather the necessary information. Your primary goal is to be truthful and persuasive.**

**KNOWLEDGE BASE USAGE RULES (NON-NEGOTIABLE):**
1.  For the overall call structure, introduction, and flow, you MUST primarily use the content from any Knowledge Base item categorized as **'Pitch'**.
2.  For factual content about the product, including features, benefits, and value propositions, you MUST exclusively use content from items categorized as **'Product Description'**.
3.  For pricing details, offers, and discounts, you MUST use content from items categorized as **'Pricing'**.
4.  If a category of document is missing, you must state that in the 'notesForAgent' and generate a generic but safe response for that section.
5.  Never invent information. If the KB doesn't provide a detail, do not mention it.

**Clarity and Simplicity Mandate:** The generated pitch must be **crystal clear and easily understandable** for a customer on a phone call. Use simple language, short sentences, and a logical flow. Avoid jargon, complex terms, or overly corporate phrasing. The goal is persuasion through clarity.

**User and Pitch Context:**
- Product: {{product}}
- Brand Name: {{#if brandName}}{{brandName}}{{else}}{{product}}{{/if}}
- Customer Cohort: {{customerCohort}}
- Sales Plan (if specified): {{salesPlan}}
- Offer (if specified): {{offer}}
- Agent Name (if specified): {{agentName}}
- Customer Name (if specified): {{userName}}

{{#if optimizationContext}}
**Optimization Insights (from previous call analysis):**
You MUST use these insights to refine the pitch. Lean into the strengths and address the weaknesses.
\`\`\`
{{{optimizationContext}}}
\`\`\`
{{/if}}

**Knowledge Base Context (Your Sole Source of Information):**
\`\`\`
{{{knowledgeBaseContext}}}
\`\`\`

**Output Generation Rules & Pitch Structure (Strictly follow this):**

You MUST populate EVERY field in the 'GeneratePitchOutputSchema' based *only* on the context above, using the designated sections for their intended purpose.

- **pitchTitle**: A compelling title for the pitch.
- **warmIntroduction**: A brief, friendly opening. Introduce the agent (using "{{agentName}}" if provided, otherwise "your agent") and the brand ("{{brandName}}"). This section **MUST** include a clear **statement of purpose for the call**, derived from a **'Pitch'** category document in the Knowledge Base.
- **personalizedHook**: A hook tailored to the customer cohort, expanding on the reason for the call. This is the most critical part for personalization. Analyze the cohort name (e.g., 'Payment Dropoff', 'Expired Users', 'New Prospect Outreach') and craft an opening that shows you understand their specific situation.
    *   For 'Payment Dropoff' or 'Plan Page Dropoff', reference their recent interest and make it easy to complete the process.
    *   For 'Expired Users', welcome them back and briefly mention what's new or improved, using the KB.
    *   For 'New Prospect Outreach', the hook should be engaging and clearly state the value proposition for a first-time listener.
- **productExplanation**: Explain the product's core value proposition. **Source this information *only* from a 'Product Description' document in the Knowledge Base.** Do not repeat information from the introduction or hook.
- **keyBenefitsAndBundles**: Highlight 2-4 key benefits and any bundles. **Source this information *only* from a 'Product Description' document in the Knowledge Base.**
- **discountOrDealExplanation**: Explain the specific deal or plan availability. Use "<INSERT_PRICE>" for the price. **Source this information *only* from a 'Pricing' document in the Knowledge Base.**
- **objectionHandlingPreviews**: Proactively address 1-2 common objections. **Source this information *only* from 'Rebuttals' or 'Product Description' documents in the Knowledge Base.**
- **finalCallToAction**: A clear, direct call to action that closes with a clear CTA.
- **fullPitchScript**: A complete dialogue integrating all components above. Use the **'Pitch'** documents to guide the overall narrative. Target 450-600 words. Use placeholders like {{agentName}}, {{userName}}, etc.
- **estimatedDuration**: Estimate the speaking time for the agent's script.
- **notesForAgent**: Provide notes for the agent. If the KB was insufficient for any section, mention it here (e.g., "Note: The provided Knowledge Base lacked a 'Pricing' document. The deal section is generic.").

**Tone:** Elite, concise sales script grounded in KB; empathetic and persuasive.
Generate the pitch.
`,j=e.ai.definePrompt({name:"generatePitchPrompt",input:{schema:g.DO},output:{schema:g.sC},prompt:i,model:f.e.MULTIMODAL_PRIMARY,config:{temperature:.4}}),k=e.ai.definePrompt({name:"generatePitchPromptFallback",input:{schema:g.DO},output:{schema:g.sC},prompt:i,model:f.e.MULTIMODAL_SECONDARY,config:{temperature:.35}}),l=e.ai.defineFlow({name:"generatePitchFlow",inputSchema:g.DO,outputSchema:g.sC},async a=>{let b;if(!a.knowledgeBaseContext||a.knowledgeBaseContext.trim().length<50||a.knowledgeBaseContext.includes("No specific knowledge base content found")){let b=`The general Knowledge Base for '${a.product}' is too sparse or missing. The AI cannot generate a meaningful pitch without sufficient product details. Please update the general Knowledge Base with documents for this product.`;return{pitchTitle:"Pitch Generation Failed - Insufficient Knowledge Base",warmIntroduction:b,personalizedHook:"(KB content insufficient to generate distinct content)",productExplanation:"(KB content insufficient to generate distinct content)",keyBenefitsAndBundles:"(KB content insufficient to generate distinct content)",discountOrDealExplanation:"(KB content insufficient to generate distinct content)",objectionHandlingPreviews:"(KB content insufficient to generate distinct content)",finalCallToAction:"(KB content insufficient to generate distinct content)",fullPitchScript:`Pitch generation aborted due to insufficient Knowledge Base content for product '${a.product}'. AI requires detailed KB to create a relevant pitch. ${b}`,estimatedDuration:"N/A",notesForAgent:"Knowledge Base needs to be populated for this product to enable effective pitch generation."}}try{({output:b}=await j(a))}catch(c){console.warn("Primary pitch generation model failed, attempting fallback.",c);try{({output:b}=await k(a))}catch(b){console.error("Fallback pitch generation model also failed.",b);let a=Error(`Primary model error: ${c?.message||c} | Fallback error: ${b?.message||b}`);throw a.name="PitchGenerationModelError",a}}if(!b||!b.fullPitchScript||b.fullPitchScript.length<50)throw console.error("generatePitchFlow: AI returned no or very short pitch script. Input context (truncated):",JSON.stringify({...a,knowledgeBaseContext:a.knowledgeBaseContext.substring(0,200)+"..."},null,2)),Error("AI failed to generate a complete pitch script. The response from the model was empty or too short.");return b});async function m(a){let b=g.DO.safeParse(a);if(!b.success){console.error("Invalid input for generatePitch:",b.error.format());let a=b.error.errors.map(a=>`${a.path.join(".")}: ${a.message}`).join("; ");return{pitchTitle:"Pitch Generation Failed - Invalid Input",warmIntroduction:`Input validation failed: ${a.substring(0,250)}`,personalizedHook:"(Invalid input prevented distinct content generation)",productExplanation:"(Invalid input prevented distinct content generation)",keyBenefitsAndBundles:"(Invalid input prevented distinct content generation)",discountOrDealExplanation:"(Invalid input prevented distinct content generation)",objectionHandlingPreviews:"(Invalid input prevented distinct content generation)",finalCallToAction:"(Invalid input prevented distinct content generation)",fullPitchScript:`Pitch generation aborted due to invalid input. Details: ${a}`,estimatedDuration:"N/A",notesForAgent:"Input validation failed. Check server console for details."}}try{return await l(b.data)}catch(d){console.error("Catastrophic error calling generatePitchFlow:",JSON.stringify(d,Object.getOwnPropertyNames(d),2));let a="Pitch Generation Failed - AI Error",b=`The AI model encountered an error and could not generate the pitch. Details: ${d.message||"An unexpected error occurred"}.`,c=d.message?.toLowerCase()||"";return c.includes("429")||c.includes("quota")?(a="Pitch Generation Failed - API Quota Exceeded",b=`You have exceeded your current API quota for the AI model(s). Please check your billing details or wait for the quota to reset. Original error: ${d.message}`):c.includes("api key")||c.includes("permission denied")?(a="Pitch Generation Failed - API Key/Permission Issue",b=`There seems to be an issue with the API key or permissions for the AI models. Please check server logs and ensure the Google API Key is valid and has access to the Gemini models. Original error: ${d.message}`):c.includes("safety settings")||c.includes("blocked")?(a="Pitch Generation Failed - Content Safety",b=`The pitch generation was blocked, likely due to content safety filters. The combination of your prompt and Knowledge Base content might have triggered this. Original error: ${d.message}`):(c.includes("model returned no response")||c.includes("empty or too short"))&&(a="Pitch Generation Failed - No AI Response",b=`The AI model did not return a valid response, or the response was empty/too short. This might be due to overly restrictive input or a temporary model issue. Original error: ${d.message}`),{pitchTitle:a,warmIntroduction:b,personalizedHook:"(AI error prevented distinct content generation)",productExplanation:"(AI error prevented distinct content generation)",keyBenefitsAndBundles:"(AI error prevented distinct content generation)",discountOrDealExplanation:"(AI error prevented distinct content generation)",objectionHandlingPreviews:"(AI error prevented distinct content generation)",finalCallToAction:"(AI error prevented distinct content generation)",fullPitchScript:`Pitch generation failed due to an AI service error. Details: ${b}. Please check server logs. Input context provided to AI may have caused issues.`,estimatedDuration:"N/A",notesForAgent:"AI service error during pitch generation. Check server logs and KB content quality for the selected product, or the content/format of any directly uploaded file."}}}(0,h.D)([m]),(0,d.A)(m,"408cd05a17b5cea88f672d9bb8d04a22a7b8dee8b8",null)},12412:a=>{"use strict";a.exports=require("assert")},14985:a=>{"use strict";a.exports=require("dns")},16698:a=>{"use strict";a.exports=require("node:async_hooks")},17558:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/Anchit.Tandon/Desktop/AI HUSTLE - APPS/AI-Telesuite-FireBase/src/app/(main)/voice-sales-agent/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/Anchit.Tandon/Desktop/AI HUSTLE - APPS/AI-Telesuite-FireBase/src/app/(main)/voice-sales-agent/page.tsx","default")},19063:a=>{"use strict";a.exports=require("require-in-the-middle")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19185:a=>{"use strict";a.exports=require("dgram")},19771:a=>{"use strict";a.exports=require("process")},21820:a=>{"use strict";a.exports=require("os")},24207:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"BailoutToCSR",{enumerable:!0,get:function(){return e}});let d=c(84339);function e(a){let{reason:b,children:c}=a;throw Object.defineProperty(new d.BailoutToCSRError(b),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}},26713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},27910:a=>{"use strict";a.exports=require("stream")},28149:(a,b,c)=>{Promise.resolve().then(c.bind(c,79241))},28354:a=>{"use strict";a.exports=require("util")},29021:a=>{"use strict";a.exports=require("fs")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33540:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"default",{enumerable:!0,get:function(){return e}});let d=c(35288)._(c(43972));function e(a,b){var c;let e={};"function"==typeof a&&(e.loader=a);let f={...e,...b};return(0,d.default)({...f,modules:null==(c=f.loadableGenerated)?void 0:c.modules})}("function"==typeof b.default||"object"==typeof b.default&&null!==b.default)&&void 0===b.default.__esModule&&(Object.defineProperty(b.default,"__esModule",{value:!0}),Object.assign(b.default,b),a.exports=b.default)},33873:a=>{"use strict";a.exports=require("path")},34631:a=>{"use strict";a.exports=require("tls")},37067:a=>{"use strict";a.exports=require("node:http")},37830:a=>{"use strict";a.exports=require("node:stream/web")},38522:a=>{"use strict";a.exports=require("node:zlib")},41025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},43972:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"default",{enumerable:!0,get:function(){return j}});let d=c(21124),e=c(38301),f=c(24207),g=c(52402);function h(a){return{default:a&&"default"in a?a.default:a}}let i={loader:()=>Promise.resolve(h(()=>null)),loading:null,ssr:!0},j=function(a){let b={...i,...a},c=(0,e.lazy)(()=>b.loader().then(h)),j=b.loading;function k(a){let h=j?(0,d.jsx)(j,{isLoading:!0,pastDelay:!0,error:null}):null,i=!b.ssr||!!b.loading,k=i?e.Suspense:e.Fragment,l=b.ssr?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(g.PreloadChunks,{moduleIds:b.modules}),(0,d.jsx)(c,{...a})]}):(0,d.jsx)(f.BailoutToCSR,{reason:"next/dynamic",children:(0,d.jsx)(c,{...a})});return(0,d.jsx)(k,{...i?{fallback:h}:{},children:l})}return k.displayName="LoadableComponent",k}},44708:a=>{"use strict";a.exports=require("node:https")},52402:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"PreloadChunks",{enumerable:!0,get:function(){return h}});let d=c(21124),e=c(23312),f=c(29294),g=c(61348);function h(a){let{moduleIds:b}=a,c=f.workAsyncStorage.getStore();if(void 0===c)return null;let h=[];if(c.reactLoadableManifest&&b){let a=c.reactLoadableManifest;for(let c of b){if(!a[c])continue;let b=a[c].files;h.push(...b)}}return 0===h.length?null:(0,d.jsx)(d.Fragment,{children:h.map(a=>{let b=c.assetPrefix+"/_next/"+(0,g.encodeURIPath)(a);return a.endsWith(".css")?(0,d.jsx)("link",{precedence:"dynamic",href:b,rel:"stylesheet",as:"style"},a):((0,e.preload)(b,{as:"script",fetchPriority:"low"}),null)})})}},54292:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d=(0,c(8808).A)("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]])},55511:a=>{"use strict";a.exports=require("crypto")},55591:a=>{"use strict";a.exports=require("https")},56801:a=>{"use strict";a.exports=require("import-in-the-middle")},57075:a=>{"use strict";a.exports=require("node:stream")},57265:a=>{"use strict";a.exports=require("child_process")},57975:a=>{"use strict";a.exports=require("node:util")},61348:(a,b)=>{"use strict";function c(a){return a.split("/").map(a=>encodeURIComponent(a)).join("/")}Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"encodeURIPath",{enumerable:!0,get:function(){return c}})},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},72412:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>D.a,__next_app__:()=>J,handler:()=>L,pages:()=>I,routeModule:()=>K,tree:()=>H});var d=c(49754),e=c(9117),f=c(46595),g=c(32324),h=c(39326),i=c(38928),j=c(20175),k=c(12),l=c(54290),m=c(12696),n=c(82802),o=c(77533),p=c(45229),q=c(32822),r=c(261),s=c(26453),t=c(52474),u=c(26713),v=c(51356),w=c(62685),x=c(36225),y=c(63446),z=c(2762),A=c(45742),B=c(86439),C=c(81170),D=c.n(C),E=c(62506),F=c(91203),G={};for(let a in E)0>["default","tree","pages","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(G[a]=()=>E[a]);c.d(b,G);let H={children:["",{children:["(main)",{children:["voice-sales-agent",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,17558)),"/Users/Anchit.Tandon/Desktop/AI HUSTLE - APPS/AI-Telesuite-FireBase/src/app/(main)/voice-sales-agent/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(c.bind(c,64261)),"/Users/Anchit.Tandon/Desktop/AI HUSTLE - APPS/AI-Telesuite-FireBase/src/app/(main)/layout.tsx"],"not-found":[()=>Promise.resolve().then(c.t.bind(c,87028,23)),"next/dist/client/components/builtin/not-found.js"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,90461,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,32768,23)),"next/dist/client/components/builtin/unauthorized.js"],metadata:{icon:[async a=>(await Promise.resolve().then(c.bind(c,70440))).default(a)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(c.bind(c,51472)),"/Users/Anchit.Tandon/Desktop/AI HUSTLE - APPS/AI-Telesuite-FireBase/src/app/layout.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,81170,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.t.bind(c,87028,23)),"next/dist/client/components/builtin/not-found.js"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,90461,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,32768,23)),"next/dist/client/components/builtin/unauthorized.js"],metadata:{icon:[async a=>(await Promise.resolve().then(c.bind(c,70440))).default(a)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,I=["/Users/Anchit.Tandon/Desktop/AI HUSTLE - APPS/AI-Telesuite-FireBase/src/app/(main)/voice-sales-agent/page.tsx"],J={require:c,loadChunk:()=>Promise.resolve()},K=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/(main)/voice-sales-agent/page",pathname:"/voice-sales-agent",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:H},distDir:".next",relativeProjectDir:""});async function L(a,b,d){var C;let G="/(main)/voice-sales-agent/page";"/index"===G&&(G="/");let M=(0,h.getRequestMeta)(a,"postponed"),N=(0,h.getRequestMeta)(a,"minimalMode"),O=await K.prepare(a,b,{srcPage:G,multiZoneDraftMode:!1});if(!O)return b.statusCode=400,b.end("Bad Request"),null==d.waitUntil||d.waitUntil.call(d,Promise.resolve()),null;let{buildId:P,query:Q,params:R,parsedUrl:S,pageIsDynamic:T,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,serverActionsManifest:X,clientReferenceManifest:Y,subresourceIntegrityManifest:Z,prerenderManifest:$,isDraftMode:_,resolvedPathname:aa,revalidateOnlyGenerated:ab,routerServerContext:ac,nextConfig:ad,interceptionRoutePatterns:ae}=O,af=S.pathname||"/",ag=(0,r.normalizeAppPath)(G),{isOnDemandRevalidate:ah}=O,ai=K.match(af,$),aj=!!$.routes[aa],ak=!!(ai||aj||$.routes[ag]),al=a.headers["user-agent"]||"",am=(0,u.getBotType)(al),an=(0,p.isHtmlBotRequest)(a),ao=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??"1"===a.headers[t.NEXT_ROUTER_PREFETCH_HEADER],ap=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[t.RSC_HEADER],aq=(0,s.getIsPossibleServerAction)(a),ar=(0,m.checkIsAppPPREnabled)(ad.experimental.ppr)&&(null==(C=$.routes[ag]??$.dynamicRoutes[ag])?void 0:C.renderingMode)==="PARTIALLY_STATIC",as=!1,at=!1,au=ar?M:void 0,av=ar&&ap&&!ao,aw=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),ax=!al||(0,p.shouldServeStreamingMetadata)(al,ad.htmlLimitedBots);an&&ar&&(ak=!1,ax=!1);let ay=!0===K.isDev||!ak||"string"==typeof M||av,az=an&&ar,aA=null;_||!ak||ay||aq||au||av||(aA=aa);let aB=aA;!aB&&K.isDev&&(aB=aa),K.isDev||_||!ak||!ap||av||(0,k.d)(a.headers);let aC={...E,tree:H,pages:I,GlobalError:D(),handler:L,routeModule:K,__next_app__:J};X&&Y&&(0,o.setReferenceManifestsSingleton)({page:G,clientReferenceManifest:Y,serverActionsManifest:X,serverModuleMap:(0,q.createServerModuleMap)({serverActionsManifest:X})});let aD=a.method||"GET",aE=(0,g.getTracer)(),aF=aE.getActiveScopeSpan();try{let f=K.getVaryHeader(aa,ae);b.setHeader("Vary",f);let k=async(c,d)=>{let e=new l.NodeNextRequest(a),f=new l.NodeNextResponse(b);return K.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=aE.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${aD} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aD} ${a.url}`)})},m=async({span:e,postponed:f,fallbackRouteParams:g})=>{let i={query:Q,params:R,page:ag,sharedContext:{buildId:P},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aC,Component:(0,j.T)(aC),params:R,routeModule:K,page:G,postponed:f,shouldWaitOnAllReady:az,serveStreamingMetadata:ax,supportsDynamicResponse:"string"==typeof f||ay,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,subresourceIntegrityManifest:Z,serverActionsManifest:X,clientReferenceManifest:Y,setIsrStatus:null==ac?void 0:ac.setIsrStatus,dir:c(33873).join(process.cwd(),K.relativeProjectDir),isDraftMode:_,isRevalidate:ak&&!f&&!av,botType:am,isOnDemandRevalidate:ah,isPossibleServerAction:aq,assetPrefix:ad.assetPrefix,nextConfigOutput:ad.output,crossOrigin:ad.crossOrigin,trailingSlash:ad.trailingSlash,previewProps:$.preview,deploymentId:ad.deploymentId,enableTainting:ad.experimental.taint,htmlLimitedBots:ad.htmlLimitedBots,devtoolSegmentExplorer:ad.experimental.devtoolSegmentExplorer,reactMaxHeadersLength:ad.reactMaxHeadersLength,multiZoneDraftMode:!1,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:ad.experimental.cacheLife,basePath:ad.basePath,serverActions:ad.experimental.serverActions,...as?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isRevalidate:!0,isDebugDynamicAccesses:as}:{},experimental:{isRoutePPREnabled:ar,expireTime:ad.expireTime,staleTimes:ad.experimental.staleTimes,cacheComponents:!!ad.experimental.cacheComponents,clientSegmentCache:!!ad.experimental.clientSegmentCache,clientParamParsing:!!ad.experimental.clientParamParsing,dynamicOnHover:!!ad.experimental.dynamicOnHover,inlineCss:!!ad.experimental.inlineCss,authInterrupts:!!ad.experimental.authInterrupts,clientTraceMetadata:ad.experimental.clientTraceMetadata||[]},waitUntil:d.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>K.onRequestError(a,b,d,ac),err:(0,h.getRequestMeta)(a,"invokeError"),dev:K.isDev}},l=await k(e,i),{metadata:m}=l,{cacheControl:n,headers:o={},fetchTags:p}=m;if(p&&(o[y.NEXT_CACHE_TAGS_HEADER]=p),a.fetchMetrics=m.fetchMetrics,ak&&(null==n?void 0:n.revalidate)===0&&!K.isDev&&!ar){let a=m.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${aa}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:v.CachedRouteKind.APP_PAGE,html:l,headers:o,rscData:m.flightData,postponed:m.postponed,status:m.statusCode,segmentData:m.segmentData},cacheControl:n}},o=async({hasResolved:c,previousCacheEntry:f,isRevalidating:g,span:i})=>{let j,k=!1===K.isDev,l=c||b.writableEnded;if(ah&&ab&&!f&&!N)return(null==ac?void 0:ac.render404)?await ac.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ai&&(j=(0,w.parseFallbackField)(ai.fallback)),j===w.FallbackMode.PRERENDER&&(0,u.isBot)(al)&&(!ar||an)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),(null==f?void 0:f.isStale)===-1&&(ah=!0),ah&&(j!==w.FallbackMode.NOT_FOUND||f)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),!N&&j!==w.FallbackMode.BLOCKING_STATIC_RENDER&&aB&&!l&&!_&&T&&(k||!aj)){let b;if((k||ai)&&j===w.FallbackMode.NOT_FOUND)throw new B.NoFallbackError;if(ar&&!ap){let c="string"==typeof(null==ai?void 0:ai.fallback)?ai.fallback:k?ag:null;if(b=await K.handleResponse({cacheKey:c,req:a,nextConfig:ad,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:$,isRoutePPREnabled:ar,responseGenerator:async()=>m({span:i,postponed:void 0,fallbackRouteParams:k||at?(0,n.u)(ag):null}),waitUntil:d.waitUntil}),null===b)return null;if(b)return delete b.cacheControl,b}}let o=ah||g||!au?void 0:au;if(as&&void 0!==o)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:v.CachedRouteKind.PAGES,html:x.default.EMPTY,pageData:{},headers:void 0,status:void 0}};let p=T&&ar&&((0,h.getRequestMeta)(a,"renderFallbackShell")||at)?(0,n.u)(af):null;return m({span:i,postponed:o,fallbackRouteParams:p})},p=async c=>{var f,g,i,j,k;let l,n=await K.handleResponse({cacheKey:aA,responseGenerator:a=>o({span:c,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:ah,isRoutePPREnabled:ar,req:a,nextConfig:ad,prerenderManifest:$,waitUntil:d.waitUntil});if(_&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),K.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!n){if(aA)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(f=n.value)?void 0:f.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(i=n.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let p="string"==typeof n.value.postponed;ak&&!av&&(!p||ao)&&(N||b.setHeader("x-nextjs-cache",ah?"REVALIDATED":n.isMiss?"MISS":n.isStale?"STALE":"HIT"),b.setHeader(t.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=n;if(au)l={revalidate:0,expire:void 0};else if(N&&ap&&!ao&&ar)l={revalidate:0,expire:void 0};else if(!K.isDev)if(_)l={revalidate:0,expire:void 0};else if(ak){if(n.cacheControl)if("number"==typeof n.cacheControl.revalidate){if(n.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${n.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});l={revalidate:n.cacheControl.revalidate,expire:(null==(j=n.cacheControl)?void 0:j.expire)??ad.expireTime}}else l={revalidate:y.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(l={revalidate:0,expire:void 0});if(n.cacheControl=l,"string"==typeof aw&&(null==q?void 0:q.kind)===v.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(k=q.headers)?void 0:k[y.NEXT_CACHE_TAGS_HEADER];N&&ak&&c&&"string"==typeof c&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(aw);return void 0!==d?(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(d,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl}):(b.statusCode=204,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:n.cacheControl}))}let r=(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r({...n,value:{...n.value,kind:"PAGE"}},{url:(0,h.getRequestMeta)(a,"initURL")}))return null;if(p&&au)throw Object.defineProperty(Error("Invariant: postponed state should not be present on a resume request"),"__NEXT_ERROR_CODE",{value:"E396",enumerable:!1,configurable:!0});if(q.headers){let a={...q.headers};for(let[c,d]of(N&&ak||delete a[y.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let s=null==(g=q.headers)?void 0:g[y.NEXT_CACHE_TAGS_HEADER];if(N&&ak&&s&&"string"==typeof s&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,s),!q.status||ap&&ar||(b.statusCode=q.status),!N&&q.status&&F.RedirectStatusCode[q.status]&&ap&&(b.statusCode=200),p&&b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"1"),ap&&!_){if(void 0===q.rscData){if(q.postponed)throw Object.defineProperty(Error("Invariant: Expected postponed to be undefined"),"__NEXT_ERROR_CODE",{value:"E372",enumerable:!1,configurable:!0});return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:q.html,cacheControl:av?{revalidate:0,expire:void 0}:n.cacheControl})}return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(q.rscData,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl})}let u=q.html;if(!p||N||ap)return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:n.cacheControl});if(as)return u.push(new ReadableStream({start(a){a.enqueue(z.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}});let w=new TransformStream;return u.push(w.readable),m({span:c,postponed:q.postponed,fallbackRouteParams:null}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(w.writable)}).catch(a=>{w.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}})};if(!aF)return await aE.withPropagatedContext(a.headers,()=>aE.trace(i.BaseServerSpan.handleRequest,{spanName:`${aD} ${a.url}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aD,"http.target":a.url}},p));await p(aF)}catch(b){throw b instanceof B.NoFallbackError||await K.onRequestError(a,b,{routerKind:"App Router",routePath:G,routeType:"render",revalidateReason:(0,f.c)({isRevalidate:ak,isOnDemandRevalidate:ah})},ac),b}}},73024:a=>{"use strict";a.exports=require("node:fs")},73136:a=>{"use strict";a.exports=require("node:url")},73496:a=>{"use strict";a.exports=require("http2")},73566:a=>{"use strict";a.exports=require("worker_threads")},74075:a=>{"use strict";a.exports=require("zlib")},74998:a=>{"use strict";a.exports=require("perf_hooks")},76760:a=>{"use strict";a.exports=require("node:path")},77030:a=>{"use strict";a.exports=require("node:net")},77598:a=>{"use strict";a.exports=require("node:crypto")},79241:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>T});var d=c(21124),e=c(38301),f=c(33540),g=c.n(f),h=c(89266),i=c(35284),j=c(62186),k=c(45608),l=c(93758),m=c(68120),n=c(64772),o=c(80665),p=c(45019),q=c(93302),r=c(99187),s=c(37448),t=c(90629),u=c(44183),v=c(76530),w=c(7952),x=c(40735),y=c(55199),z=c(85708);let A=(0,z.createServerReference)("40481652c6e515f70ff0f4f0899456d583cb098e56",z.callServer,void 0,z.findSourceMapURL,"runVoiceSalesAgentTurn");var B=c(98590),C=c(49113),D=c(99388),E=c(68334),F=c(54039),G=c(92080),H=c(54292),I=c(51886),J=c(67362);let K=(0,c(8808).A)("PhoneCall",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]]);var L=c(66533),M=c(38692),N=c(59487),O=c(89308),P=c(23727);let Q=g()(async()=>{},{loadableGenerated:{modules:["app/(main)/voice-sales-agent/page.tsx -> @/components/features/voice-sales-agent/post-call-review"]},loading:()=>(0,d.jsxs)("div",{className:"flex items-center justify-center p-8 text-muted-foreground",children:[(0,d.jsx)(C.A,{className:"mr-2 h-4 w-4 animate-spin"})," Loading call review..."]}),ssr:!1}),R=(a,b,c,d)=>{if(!b)return"No product information available.";let e=`--- START OF KNOWLEDGE BASE CONTEXT FOR PRODUCT: ${b.displayName} ---
`;e+=`Brand Name: ${b.brandName||"Not provided"}
`,d&&(e+=`Target Customer Cohort: ${d}
`),e+="--------------------------------------------------\n\n";let f=a.filter(a=>a.product===b.name),g=(a,b)=>{b.length>0&&(e+=`--- ${a.toUpperCase()} ---
`,b.forEach(a=>{let b=`
--- Item: ${a.name} ---
`;a.isTextEntry&&a.textContent?b+=`Content:
${a.textContent}
`:b+=`(This is a reference to a ${a.type} file named '${a.name}'. The AI should infer context from its name, type, and category.)
`,e.length+b.length<=3e4&&(e+=b)}),e+=`--- END ${a.toUpperCase()} ---

`)},h=f.filter(a=>"Pitch"===a.category),i=f.filter(a=>"Product Description"===a.category),j=f.filter(a=>"Pricing"===a.category),k=f.filter(a=>"Rebuttals"===a.category),l=f.filter(a=>!a.category||!["Pitch","Product Description","Pricing","Rebuttals"].includes(a.category));return g("PITCH STRUCTURE & FLOW CONTEXT (Prioritize for overall script structure)",h),g("PRODUCT DETAILS & FACTS (Prioritize for benefits, features, pricing)",[...i,...j]),g("COMMON OBJECTIONS & REBUTTALS",k),g("GENERAL SUPPLEMENTARY CONTEXT",l),0===f.length&&(e+="No specific knowledge base files or text entries were found for this product.\n"),e.length>=3e4&&console.warn("Knowledge base context truncated due to length limit."),(e+="--- END OF KNOWLEDGE BASE CONTEXT ---").substring(0,3e4)},S=a=>"AI"===a?"AGENT":"USER";function T(){let[a,b]=(0,e.useState)("CONFIGURING"),f=(0,e.useRef)(a),[g,z]=(0,e.useState)(""),[T,U]=(0,e.useState)(!1),[V,W]=(0,e.useState)(""),[X,Y]=(0,e.useState)(""),{availableProducts:Z,getProductByName:$}=(0,w.G)(),[_,aa]=(0,e.useState)("ET"),ab=$(_||""),[ac,ad]=(0,e.useState)(),[ae,af]=(0,e.useState)(),[ag,ah]=(0,e.useState)(""),[ai,aj]=(0,e.useState)("Payment Dropoff"),[ak,al]=(0,e.useState)([]),[am,an]=(0,e.useState)(null),[ao,ap]=(0,e.useState)(null),[aq,ar]=(0,e.useState)(null),[as,at]=(0,e.useState)(null),au=(0,e.useRef)(null),av=(0,e.useRef)(null),aw=(0,e.useRef)([]),[ax,ay]=(0,e.useState)(null),[az,aA]=(0,e.useState)(-1),[aB,aC]=(0,e.useState)(!1),{toast:aD}=(0,s.dj)(),{activities:aE,logActivity:aF,updateActivity:aG}=(0,t.Z)(),{files:aH}=(0,u.J)(),aI=(0,e.useRef)(null),aJ=(0,e.useRef)(null),[aK,aL]=(0,e.useState)(x.U[0].id),aM="CONFIGURING"!==a&&"IDLE"!==a&&"ENDED"!==a,[aN,aO]=(0,e.useState)(!1),aP=(0,e.useMemo)(()=>_&&aH?aH.filter(a=>a.product===_):[],[aH,_]),aQ=(0,e.useRef)(null),aR=(0,e.useRef)(null),aS=((0,e.useRef)(null),(0,e.useRef)(null)),aT=(0,e.useRef)([]),aU=((0,e.useRef)(Date.now()),(0,e.useRef)(null),(0,e.useRef)(null),(0,e.useRef)(null),(0,e.useCallback)(async()=>{},[!1])),aV=(0,e.useCallback)(async()=>null,[!1]),aW=(0,e.useCallback)(a=>new Promise((b,c)=>{let d=new FileReader;d.onloadend=()=>{"string"==typeof d.result?b(d.result):c(Error("Failed to read audio recording."))},d.onerror=()=>c(d.error??Error("Failed to read audio recording.")),d.readAsDataURL(a)}),[]),aX=(0,e.useCallback)(()=>aT.current.length>0?new Blob(aT.current,{type:aS.current?.mimeType||"audio/webm"}):null,[]),aY=((0,e.useCallback)(async()=>{let a=aX();if(a)try{let b=await aW(a);at(b)}catch(a){console.warn("Failed to update current recording:",a)}},[aX,aW]),(0,e.useCallback)(()=>{aw.current=[],av.current&&(av.current.pause(),av.current.removeAttribute("src"),av.current.currentTime=0),ay(null),aA(-1),"AI_SPEAKING"===f.current&&b("LISTENING")},[])),aZ=(0,e.useCallback)(a=>{"AI_SPEAKING"===f.current&&a.trim().length>0&&aY(),z(a)},[aY]),a$=(0,e.useRef)(null),a_=(0,e.useRef)(null),a0=(0,e.useCallback)((a,b)=>{let c=a.play();c&&"function"==typeof c.catch&&c.catch(a=>{a?.name==="AbortError"||a?.message?.includes("The play() request was interrupted")||b(a)})},[]),a1=(0,e.useCallback)((a,c)=>{av.current&&(aw.current=[],av.current.pause(),av.current.src=a,av.current.currentTime=0,aA(-1),ay(c),b("AI_SPEAKING"),a0(av.current,a=>{console.error("VoiceAgent: playback failed",a),b("LISTENING")}))},[a0]),a2=(0,e.useCallback)(async a=>{if("LISTENING"!==f.current&&"AI_SPEAKING"!==f.current)return;let b=a.trim();z("");let c=b?{id:`user-${Date.now()}`,speaker:"User",text:b,timestamp:new Date().toISOString()}:null,d=c?[...ak,c]:ak;c&&al(d),a_.current&&a_.current(d,b)},[ak]),{isRecording:a3,startRecording:a4,stopRecording:a5}=(0,v.C)({onTranscriptionComplete:a2,onTranscribe:aZ,silenceTimeout:30,inactivityTimeout:5e3}),a6=(0,e.useCallback)(async(a,c)=>{let d=a?.trim();if(!d)return void b("LISTENING");b("AI_SPEAKING");try{let a=d.replace(/\bET\b/g,"E T"),e=performance.now(),f=await (0,y.T)({text:a,voice:aK}),g=performance.now();console.log(`VoiceAgent: TTS synthesis completed in ${(g-e).toFixed(2)}ms for ${a.length} characters`);let h=f.audioDataUri;if(al(a=>a.map(a=>a.id===c?{...a,audioDataUri:h}:a)),av.current){aw.current=[],ay(c),aA(-1);try{aR.current&&"suspended"===aR.current.state&&await aR.current.resume()}catch(a){console.warn("VoiceAgent: failed to resume audio context before playback",a)}av.current.pause(),av.current.src=h,av.current.currentTime=0,a0(av.current,a=>{console.error("Audio playback error:",a),aD({variant:"destructive",title:"Playback Error",description:`Could not play audio: ${a.message}`}),b("LISTENING")})}else b("LISTENING")}catch(a){console.error("TTS synthesis error:",a),aD({variant:"destructive",title:"TTS Error",description:a.message}),b("LISTENING")}},[aK,aD,!1,aU,a0]),a7=(0,e.useRef)(0);a_.current=(0,e.useCallback)(async(a,c)=>{let d=performance.now();if(console.log(`VoiceAgent: Starting agent turn processing at ${new Date().toISOString()}`),!_||!ai||!ab)return;an(null),b("PROCESSING");let e=(()=>{let b=aQ.current,c=aP.map(a=>`${a.id}-${a.name}-${a.product}-${a.category}`).join("|");if(b&&b.filesHash===c&&b.productName===ab.name&&b.cohort===ai)return b.context;let d=R(aP,ab,a,ai);return aQ.current={filesHash:c,productName:ab.name,cohort:ai,context:d},d})();try{let d={action:"PROCESS_USER_RESPONSE",product:_,productDisplayName:ab.displayName,brandName:ab.brandName,salesPlan:ac,specialPlanConfigurations:ae,offer:ag,customerCohort:ai,agentName:V,userName:X,knowledgeBaseContext:e,conversationHistory:a,currentPitchState:ao,currentUserInputText:c,inactivityCounter:a7.current,brandUrl:ab.brandUrl},g=await A(d);if(g.generatedPitch&&ap(g.generatedPitch),g.errorMessage)throw Error(g.errorMessage);c?a7.current=0:a7.current+=1;let h=g.currentAiResponseText;if(h){let a={id:`ai-${Date.now()}`,speaker:"AI",text:h,timestamp:new Date().toISOString()};al(b=>[...b,a]),"INTERACTION_ENDED"===g.nextExpectedAction&&(aC(!0),setTimeout(()=>{"ENDED"!==f.current&&a$.current&&a$.current()},500)),await a6(h,a.id)}else b("LISTENING")}catch(c){let a=`I'm sorry, a critical system error occurred. Details: ${c.message.substring(0,200)}...`,b={id:`error-${Date.now()}`,speaker:"AI",text:a,timestamp:new Date().toISOString()};al(a=>[...a,b]),an(c.message),await a6(a,b.id)}let g=performance.now();console.log(`VoiceAgent: Agent turn completed in ${(g-d).toFixed(2)}ms (${a.length} turns in conversation)`)},[_,ab,V,X,ac,ae,ag,ai,ao,aP,aD,a6]);let a8=(0,e.useCallback)(async({transcript:a,audioDataUri:b,transcriptAccuracy:d})=>{if(!a||!_||0===a.trim().length){console.warn("VoiceAgent: Skipping scoring - no valid transcript provided"),aD({variant:"destructive",title:"Scoring Skipped",description:"No valid transcript available for scoring."});return}if(!a.includes("AGENT (Profile:")||!a.includes("USER (Profile:")){console.warn("VoiceAgent: Skipping scoring - transcript format invalid for scoring"),aD({variant:"destructive",title:"Scoring Skipped",description:"Transcript format is not compatible with scoring system."});return}let{scoreCall:e}=await c.e(815).then(c.bind(c,50815));try{let c=$(_);if(!c)throw Error("Product details not found for scoring.");let f=(()=>{let a=aQ.current,b=aP.map(a=>`${a.id}-${a.name}-${a.product}-${a.category}`).join("|");if(a&&a.filesHash===b&&a.productName===c.name&&a.cohort===(ai||""))return a.context;let d=R(aP,c,[],ai);return aQ.current={filesHash:b,productName:c.name,cohort:ai||"",context:d},d})(),g=await e({product:_,agentName:V,audioDataUri:b,transcriptOverride:a,productContext:f,brandUrl:c.brandUrl});if(ar(c=>c?{...c,transcript:a,transcriptAccuracy:d,audioUri:b,score:g}:{transcript:a,transcriptAccuracy:d,audioUri:b,score:g}),aJ.current){let a=aE.find(a=>a.id===aJ.current);a&&aG(aJ.current,{...a.details,finalScore:g})}aD({title:"Scoring Complete!",description:"The call has been scored successfully."})}catch(a){aD({variant:"destructive",title:"Scoring Failed",description:a.message})}},[_,ai,$,aP,V,aG,aD,aE]),a9=(0,e.useCallback)(async(a="Completed")=>{let c,d;a$.current=a9,a5(),aY(),b("PROCESSING");try{let a=await aV();a&&a.size>0&&(c=await aW(a))}catch(a){console.warn("VoiceAgent: failed to capture live recording, falling back to synthesis",a)}if(!c)try{let a=await (0,B.R)({conversationHistory:ak,agentVoiceProfile:aK});a.audioDataUri?c=a.audioDataUri:a.errorMessage&&aD({variant:"destructive",title:"Audio Generation Failed",description:a.errorMessage})}catch(a){aD({variant:"destructive",title:"Audio Generation Error",description:a.message})}let e=ak.map(a=>`${S(a.speaker)} (Profile: ${S(a.speaker)}): ${a.text}`).join("\n");if(c)try{let a=await fetch("/api/transcription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audioDataUri:c})});if(a.ok){let b=(await a.json()).segments.map(a=>`${a.speaker} (Profile: ${a.speakerProfile}): ${a.text}`).join("\n");b&&(e=b),d="Completed"}}catch(a){console.warn("VoiceAgent: transcription failed, using fallback transcript",a)}if(ar({transcript:e,transcriptAccuracy:d,audioUri:c}),aJ.current){let b=aE.find(a=>a.id===aJ.current);b&&aG(aJ.current,{...b.details,status:a,fullTranscriptText:e,fullConversation:ak,fullCallAudioDataUri:c,selectedKbIds:aP.map(a=>a.id)})}b("ENDED"),"Completed"===a&&setTimeout(()=>{a8({transcript:e,audioDataUri:c,transcriptAccuracy:d})},100)},[ak,a5,aY,aV,aW,B.R,aK,aD,aE,aG,aP,a8]),ba=(0,e.useCallback)(async()=>{if(!X.trim()||!V.trim()||!_||!ai||!ab)return void aD({variant:"destructive",title:"Missing Info",description:"Agent Name, Customer Name, Product, and Cohort are required."});0===aP.length&&aD({title:"No Knowledge Base Files",description:`There are no KB files for '${ab.displayName}'. The AI will rely on its general knowledge.`,duration:6e3}),a7.current=0,al([]),ap(null),ar(null),b("PROCESSING");let a={input:{product:_,customerCohort:ai,agentName:V,userName:X,voiceName:aK,selectedKbIds:aP.map(a=>a.id)},status:"In Progress"};aJ.current=aF({module:"Browser Voice Agent",product:_,details:a});try{let a=(()=>{let a=aQ.current,b=aP.map(a=>`${a.id}-${a.name}-${a.product}-${a.category}`).join("|");if(a&&a.filesHash===b&&a.productName===ab.name&&a.cohort===ai)return a.context;let c=R(aP,ab,[],ai);return aQ.current={filesHash:b,productName:ab.name,cohort:ai,context:c},c})(),b={action:"START_CONVERSATION",product:_,productDisplayName:ab.displayName,brandName:ab.brandName,salesPlan:ac,specialPlanConfigurations:ae,offer:ag,customerCohort:ai,agentName:V,userName:X,knowledgeBaseContext:a,conversationHistory:[],currentPitchState:null,brandUrl:ab.brandUrl},c=await A(b);if(c.errorMessage||!c.generatedPitch||!c.currentAiResponseText)throw Error(c.errorMessage||"Failed to generate initial pitch.");ap(c.generatedPitch);let d=c.currentAiResponseText,e={id:`ai-${Date.now()}`,speaker:"AI",text:d,timestamp:new Date().toISOString()};al([e]),await a6(d,e.id)}catch(d){let a=d.message||"Failed to start conversation.";an(a),b("ERROR");let c={id:`error-${Date.now()}`,speaker:"AI",text:a,timestamp:new Date().toISOString()};al(a=>[...a,c])}},[X,V,_,ab,ai,aK,ac,ae,ag,aF,aD,aP,a6,!1,aU,aV]),bb=(0,e.useCallback)(async()=>{let a=new Audio;a.onended=()=>aO(!1),a.onpause=()=>aO(!1),a.onerror=()=>{aD({variant:"destructive",title:"Audio Playback Error"}),aO(!1)},aO(!0);try{let b=x.R.replace(/\bET\b/g,"E T");a.src=(await (0,y.T)({text:b,voice:aK})).audioDataUri;let c=a.play();c&&"function"==typeof c.catch&&c.catch(a=>{a?.name==="AbortError"||a?.message?.includes("The play() request was interrupted")||(aD({variant:"destructive",title:"Audio Playback Error",description:a?.message}),aO(!1))})}catch(a){aD({variant:"destructive",title:"TTS Error",description:a.message}),aO(!1)}},[aK,aD]),bc=(0,e.useCallback)(()=>{if(aJ.current&&"CONFIGURING"!==f.current){let a=Array.isArray(ak)?ak:[],b=aE.find(a=>a.id===aJ.current);b&&aG(aJ.current,{...b.details,status:"Completed (Reset)",fullTranscriptText:a.map(a=>`${S(a.speaker)}: ${a.text}`).join("\n"),fullConversation:a}),aD({title:"Interaction Logged",description:"The previous call was logged before resetting."})}b("CONFIGURING"),al([]),ap(null),ar(null),an(null),aJ.current=null,z(""),aY(),a5()},[aY,ak,aG,aD,a5,aV,!1,aE]),bd=(0,e.useMemo)(()=>ab?.customerCohorts||[],[ab]),be=(0,e.useMemo)(()=>ab?.salesPlans||[],[ab]),bf=(0,e.useMemo)(()=>ab?.specialPlanConfigurations||[],[ab]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("audio",{ref:av,className:"hidden"}),(0,d.jsx)("audio",{ref:au,className:"hidden"}),(0,d.jsxs)("div",{className:"flex flex-col h-full",children:[(0,d.jsx)(h.z,{title:"AI Voice Sales Agent"}),(0,d.jsxs)("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-6",children:[(0,d.jsxs)(j.Zp,{className:"w-full max-w-4xl mx-auto",children:[(0,d.jsxs)(j.aR,{children:[(0,d.jsxs)(j.ZB,{className:"text-xl flex items-center",children:[(0,d.jsx)(H.A,{className:"mr-2 h-6 w-6 text-primary"})," Configure AI Voice Call"]}),(0,d.jsx)(j.BT,{children:"Set up agent, customer, product, and voice profile details before starting the call. The entire Knowledge Base for the selected product will be used as context."})]}),(0,d.jsxs)(j.Wu,{children:[(0,d.jsx)(O.nD,{type:"single",collapsible:!0,defaultValue:"CONFIGURING"===a?"item-config":"",className:"w-full",children:(0,d.jsxs)(O.As,{value:"item-config",children:[(0,d.jsx)(O.$m,{className:"text-md font-semibold hover:no-underline py-2 text-foreground/90 [&[data-state=open]>&svg]:rotate-180",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)(I.A,{className:"mr-2 h-4 w-4 text-accent"}),"Call Configuration"]})}),(0,d.jsxs)(O.ub,{className:"pt-3 space-y-4",children:[(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)(m.J,{children:"AI Voice Profile (Agent)"}),(0,d.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,d.jsxs)(k.l6,{value:aK,onValueChange:aL,disabled:aM,children:[(0,d.jsx)(k.bq,{className:"flex-grow",children:(0,d.jsx)(k.yv,{placeholder:"Select a voice"})}),(0,d.jsx)(k.gC,{children:x.U.map(a=>(0,d.jsx)(k.eb,{value:a.id,children:a.name},a.id))})]}),(0,d.jsx)(i.$,{variant:"outline",size:"sm",onClick:bb,disabled:aN||aM,children:aN?(0,d.jsx)(C.A,{className:"h-4 w-4 animate-spin"}):(0,d.jsx)(J.A,{className:"h-4 w-4"})})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsxs)(m.J,{htmlFor:"product-select",children:["Product ",(0,d.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,d.jsxs)(k.l6,{value:_,onValueChange:a=>aa(a),disabled:aM,children:[(0,d.jsx)(k.bq,{id:"product-select",children:(0,d.jsx)(k.yv,{placeholder:"Select a Product"})}),(0,d.jsx)(k.gC,{children:Z.map(a=>(0,d.jsx)(k.eb,{value:a.name,children:a.displayName},a.name))})]})]}),(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsxs)(m.J,{htmlFor:"cohort-select",children:["Customer Cohort ",(0,d.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,d.jsxs)(k.l6,{value:ai,onValueChange:a=>aj(a),disabled:aM||!ab||0===bd.length,children:[(0,d.jsx)(k.bq,{id:"cohort-select",children:(0,d.jsx)(k.yv,{placeholder:"Select Cohort"})}),(0,d.jsx)(k.gC,{children:bd.map(a=>(0,d.jsx)(k.eb,{value:a,children:a},a))})]})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsxs)(m.J,{htmlFor:"agent-name",children:["Agent Name ",(0,d.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,d.jsx)(l.p,{id:"agent-name",placeholder:"e.g., Samantha",value:V,onChange:a=>W(a.target.value),disabled:aM})]}),(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsxs)(m.J,{htmlFor:"user-name",children:["Customer Name ",(0,d.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,d.jsx)(l.p,{id:"user-name",placeholder:"e.g., Rohan",value:X,onChange:a=>Y(a.target.value),disabled:aM})]})]}),T&&(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[bf.length>0&&(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)(m.J,{htmlFor:"special-plan-config-select",children:"Special Plan Configuration (Optional)"}),(0,d.jsxs)(k.l6,{value:ae,onValueChange:a=>af(a),disabled:aM,children:[(0,d.jsx)(k.bq,{id:"special-plan-config-select",children:(0,d.jsx)(k.yv,{placeholder:"Select special config"})}),(0,d.jsx)(k.gC,{children:bf.map(a=>(0,d.jsx)(k.eb,{value:a,children:a},a))})]})]}),be.length>0&&(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)(m.J,{htmlFor:"plan-select",children:"Sales Plan (Optional)"}),(0,d.jsxs)(k.l6,{value:ac,onValueChange:a=>ad(a),disabled:aM,children:[(0,d.jsx)(k.bq,{id:"plan-select",children:(0,d.jsx)(k.yv,{placeholder:"Select Sales Plan"})}),(0,d.jsx)(k.gC,{children:be.map(a=>(0,d.jsx)(k.eb,{value:a,children:a},a))})]})]}),(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)(m.J,{htmlFor:"offer-details",children:"Offer Details (Optional)"}),(0,d.jsx)(l.p,{id:"offer-details",placeholder:"e.g., 20% off",value:ag,onChange:a=>ah(a.target.value),disabled:aM})]})]})]})]})}),"CONFIGURING"===a&&(0,d.jsxs)(i.$,{onClick:ba,disabled:!_||!ai||!X.trim()||!V.trim(),className:"w-full mt-4",children:[(0,d.jsx)(K,{className:"mr-2 h-4 w-4"})," Start Voice Call"]})]})]}),"CONFIGURING"!==a&&"IDLE"!==a&&(0,d.jsxs)(j.Zp,{className:"w-full max-w-4xl mx-auto mt-4",children:[(0,d.jsxs)(j.aR,{children:[(0,d.jsxs)(j.ZB,{className:"text-lg flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)(L.A,{className:"mr-2 h-5 w-5 text-primary"})," Conversation Log"]}),(()=>{switch(a){case"LISTENING":return(0,d.jsxs)(r.E,{variant:"default",className:"text-xs bg-green-100 text-green-800",children:[(0,d.jsx)(D.A,{className:"mr-1.5 h-3.5 w-3.5"}),"Listening..."]});case"AI_SPEAKING":return(0,d.jsxs)(r.E,{variant:"outline",className:"text-xs bg-amber-100 text-amber-800",children:[(0,d.jsx)(E.A,{className:"mr-1.5 h-3.5 w-3.5"}),"AI Speaking (Interruptible)"]});case"PROCESSING":return(0,d.jsxs)(r.E,{variant:"secondary",className:"text-xs",children:[(0,d.jsx)(C.A,{className:"mr-1.5 h-3.5 w-3.5 animate-spin"}),"Processing..."]});case"ENDED":return(0,d.jsxs)(r.E,{variant:"secondary",className:"text-xs bg-gray-200 text-gray-600",children:[(0,d.jsx)(F.A,{className:"mr-1.5 h-3.5 w-3.5"}),"Interaction Ended"]});case"ERROR":return(0,d.jsxs)(r.E,{variant:"destructive",className:"text-xs",children:[(0,d.jsx)(G.A,{className:"mr-1.5 h-3.5 w-3.5"}),"Error"]});default:return(0,d.jsx)(r.E,{variant:"outline",className:"text-xs",children:"Idle"})}})()]}),(0,d.jsxs)(j.BT,{children:["Interaction with ",X||"Customer",". Agent: ",V||"Default AI",". Product: ",ab?.displayName,"."]})]}),(0,d.jsxs)(j.Wu,{children:[(0,d.jsxs)(o.F,{className:"h-[300px] w-full border rounded-md p-3 bg-muted/20 mb-3",children:[ak.map(a=>(0,d.jsx)(q.j,{turn:a,onPlayAudio:a1,currentlyPlayingId:ax,wordIndex:a.id===ax?az:-1},a.id)),"LISTENING"===a&&(0,d.jsxs)("div",{className:"flex items-start gap-2.5 my-3 justify-end user-line",children:[(0,d.jsx)("div",{className:"flex flex-col gap-1 w-full max-w-[80%] items-end",children:(0,d.jsx)(j.Zp,{className:"max-w-full w-fit p-3 rounded-xl shadow-sm bg-accent/80 text-accent-foreground rounded-br-none",children:(0,d.jsx)(j.Wu,{className:"p-0 text-sm",children:(0,d.jsx)("p",{className:"italic",children:g||" Listening..."})})})}),(0,d.jsx)(P.eu,{className:"h-8 w-8 shrink-0",children:(0,d.jsx)(P.q5,{className:"bg-accent text-accent-foreground",children:(0,d.jsx)(M.A,{size:18})})})]}),"PROCESSING"===a&&(0,d.jsx)(p.k,{size:16,className:"mx-auto my-2"}),(0,d.jsx)("div",{ref:aI})]}),as&&(0,d.jsxs)("div",{className:"mb-3 p-3 border rounded-md bg-muted/10",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,d.jsx)(D.A,{className:"h-4 w-4 text-primary"}),(0,d.jsx)("span",{className:"text-sm font-medium",children:"Live Call Recording"})]}),(0,d.jsx)("audio",{ref:au,controls:!0,className:"w-full",src:as}),(0,d.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Full call recording - you can seek, rewind, and fast-forward"})]}),am&&(0,d.jsx)(n.Fc,{variant:"destructive",className:"mb-3",children:(0,d.jsx)(O.nD,{type:"single",collapsible:!0,children:(0,d.jsxs)(O.As,{value:"item-1",className:"border-b-0",children:[(0,d.jsx)(O.$m,{className:"p-0 hover:no-underline text-sm font-semibold [&_svg]:ml-1",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)(G.A,{className:"h-4 w-4 mr-2"})," An error occurred. Click to see details."]})}),(0,d.jsx)(O.ub,{className:"pt-2 text-xs",children:(0,d.jsx)("pre",{className:"whitespace-pre-wrap break-all bg-destructive/10 p-2 rounded-md font-mono",children:am})})]})})})]}),(0,d.jsxs)(j.wL,{className:"flex justify-between items-center",children:[(0,d.jsxs)(i.$,{onClick:()=>a9(),variant:"destructive",size:"sm",disabled:"ENDED"===a,children:[(0,d.jsx)(F.A,{className:"mr-2 h-4 w-4"})," End Interaction"]}),(0,d.jsxs)(i.$,{onClick:bc,variant:"outline",size:"sm",children:[(0,d.jsx)(N.A,{className:"mr-2 h-4 w-4"})," New Call"]})]})]}),aq&&"ENDED"===a&&(0,d.jsx)(Q,{artifacts:aq,agentName:V,userName:X,product:_})]})]})]})}},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},79748:a=>{"use strict";a.exports=require("fs/promises")},81231:(a,b,c)=>{"use strict";c.r(b),c.d(b,{"40481652c6e515f70ff0f4f0899456d583cb098e56":()=>r,"40592173cbe840837a40a5f15804c0744f59f71582":()=>d.t,"408ed81c3074e7991d01da4d5606a81d4f65f7dac4":()=>s.R});var d=c(20102),e=c(91488);c(27806);var f=c(38710),g=c(87603),h=c(79592),i=c(11648),j=c(56571),k=c(40410);let l=f.ai.definePrompt({name:"conversationRouterPrompt",model:j.e.MULTIMODAL_PRIMARY,input:{schema:h.Ik({conversationHistory:h.Yj().describe("A JSON string of the conversation history so far. The user has just spoken."),lastUserResponse:h.Yj()})},output:{schema:h.Ik({action:h.k5(["CONTINUE_PITCH","ANSWER_SALES_QUESTION","HANDLE_SALES_OBJECTION","ANSWER_SUPPORT_QUESTION","CLOSING_STATEMENT","ACKNOWLEDGE_AND_WAIT"]).describe("The category of action the AI should take next based on the user's last response."),thought:h.Yj().describe("A brief internal thought process on why this action was chosen.")}),format:"json"},prompt:`You are an AI sales agent controller. Your task is to analyze the user's last response within the context of the conversation history and decide the next logical action for the AI agent to take.

**Conversation History:**
\`\`\`
{{{conversationHistory}}}
\`\`\`

**User's Last Response:** "{{{lastUserResponse}}}"

**Decision Framework:**

1.  **If the user asks a SUPPORT-related question** (keywords like "login", "OTP", "error", "help", "password", "not working", "fail", "issue", "bug", "cannot", "problem"):
    *   **Action:** \`ANSWER_SUPPORT_QUESTION\`
    *   **Thought:** The user has a technical or support query that needs a factual answer.

2.  **If the user asks a SALES-related question** (keywords like "renewal", "price", "discount", "plan", "offer", "benefits", "features", "upgrade", "payment", "subscribe"):
    *   **Action:** \`ANSWER_SALES_QUESTION\`
    *   **Thought:** The user is asking for more details about the sales proposition.

3.  **If the user raises a sales OBJECTION** (e.g., "it's too expensive", "I don't have time", "I get this for free", "I'm not sure"):
    *   **Action:** \`HANDLE_SALES_OBJECTION\`
    *   **Thought:** The user has a concern about the sale that needs to be addressed before continuing.

4.  **If the user gives a positive or neutral continuation signal** (e.g., "okay", "tell me more", "I see", "hmm", "go on"):
    *   **Action:** \`CONTINUE_PITCH\`
    *   **Thought:** The user is engaged and ready for the next part of the sales pitch. Default to this if no other category fits.
    
5.  **If the user is clearly trying to end the conversation** (e.g., "I'm not interested", "goodbye", "I have to go"):
    *   **Action:** \`CLOSING_STATEMENT\`
    *   **Thought:** The conversation is over. The agent should provide a polite closing remark.
    
6.  **If the user's response is unclear, very short, or just an acknowledgement** (e.g., "ok", "yes", "no"):
    *   **Action:** \`ACKNOWLEDGE_AND_WAIT\`
    *   **Thought:** The user's input doesn't require a detailed response. A simple acknowledgement is best to keep the floor open for them.

Analyze the user's last response and determine the single best action. Default to sales-related actions if uncertain.`}),m=f.ai.definePrompt({name:"salesAnswerGeneratorPrompt",model:j.e.MULTIMODAL_PRIMARY,input:{schema:h.Ik({userQuestion:h.Yj(),knowledgeBaseContext:h.Yj(),conversationHistory:h.Yj(),brandUrl:h.Yj().url().optional()})},output:{schema:h.Ik({answer:h.Yj().describe("A direct, helpful, and conversational answer to the user's sales-related question, based ONLY on the provided Knowledge Base context. Keep it under 50 words for voice responses. Maintain a persuasive, elite sales tone.")})},prompt:`You are a helpful AI sales assistant speaking on a phone call. The user has asked a sales-related question. Use the provided Knowledge Base context to answer it accurately and persuasively.

CRITICAL: Your entire response MUST be grounded in the information provided in the 'Knowledge Base Context' section below. Keep your answer under 50 words - this is for voice responses that need to be concise and natural.

**Knowledge Base Context:**
\`\`\`
{{{knowledgeBaseContext}}}
\`\`\`

**Conversation History (for context):**
\`\`\`
{{{conversationHistory}}}
\`\`\`

**User's Question:** "{{{userQuestion}}}"

Generate a concise, natural-sounding answer based *only* on the Knowledge Base. If the KB does not contain the answer, politely say so briefly and offer to find more information.`}),n=f.ai.definePrompt({name:"supportAnswerGeneratorPrompt",model:j.e.MULTIMODAL_PRIMARY,input:{schema:h.Ik({userQuestion:h.Yj(),knowledgeBaseContext:h.Yj(),conversationHistory:h.Yj(),brandUrl:h.Yj().url().optional()})},output:{schema:h.Ik({answer:h.Yj().describe("A crisp, factual, step-by-step support answer to the user's question, based ONLY on the provided Knowledge Base context. Keep it under 60 words for voice responses.")})},prompt:`You are a crisp, factual AI support assistant speaking on a phone call. The user has asked a support question. Use the provided Knowledge Base context to provide a clear, direct answer.

CRITICAL: Your entire response MUST be grounded in the information provided in the 'Knowledge Base Context' section below. Keep your answer under 60 words - this is for voice responses that need to be concise and clear.

**Knowledge Base Context:**
\`\`\`
{{{knowledgeBaseContext}}}
\`\`\`

**Conversation History (for context):**
\`\`\`
{{{conversationHistory}}}
\`\`\`

**User's Question:** "{{{userQuestion}}}"

Generate a concise, clear answer based *only* on the Knowledge Base. If the KB does not contain the answer, politely state that you don't have the information and suggest they visit the help center.`}),o=f.ai.definePrompt({name:"objectionHandlerPrompt",model:j.e.MULTIMODAL_PRIMARY,input:{schema:h.Ik({userObjection:h.Yj(),knowledgeBaseContext:h.Yj(),conversationHistory:h.Yj(),brandUrl:h.Yj().url().optional()})},output:{schema:h.Ik({rebuttal:h.Yj().describe("An empathetic and persuasive rebuttal to the user's objection, based ONLY on the provided Knowledge Base context. Keep it under 50 words for voice responses.")})},prompt:`You are an expert AI sales coach speaking on a phone call. The user has raised an objection. Use the provided Knowledge Base context to craft an empathetic and effective rebuttal.

CRITICAL: Your entire response MUST be grounded in the information provided in the 'Knowledge Base Context' section below. Keep your rebuttal under 50 words - this is for voice responses that need to be concise and natural.

**Knowledge Base Context:**
\`\`\`
{{{knowledgeBaseContext}}}
\`\`\`

**Conversation History (for context):**
\`\`\`
{{{conversationHistory}}}
\`\`\`

**User's Objection:** "{{{userObjection}}}"

Follow the "Acknowledge, Bridge, Benefit" model to generate a concise response based *only* on the Knowledge Base. If the KB doesn't have a direct counter, acknowledge the objection and pivot to a related strength from the KB.`}),p=(a,b=12)=>JSON.stringify(Array.isArray(a)&&a.length>b?a.slice(-b):a),q=f.ai.defineFlow({name:"runVoiceSalesAgentTurn",inputSchema:g.h1,outputSchema:g.AS},async a=>{let b={conversationTurns:Array.isArray(a.conversationHistory)?[...a.conversationHistory]:[],generatedPitch:a.currentPitchState,nextExpectedAction:"USER_RESPONSE",errorMessage:void 0,currentAiResponseText:void 0};try{let{action:c,knowledgeBaseContext:d,currentUserInputText:e,inactivityCounter:f,brandUrl:g}=a;if("START_CONVERSATION"===c){let c=await (0,i.q)({product:a.product,customerCohort:a.customerCohort,knowledgeBaseContext:d,agentName:a.agentName,userName:a.userName,brandName:a.brandName,brandUrl:g,salesPlan:a.salesPlan,offer:a.offer});if(c.pitchTitle.includes("Failed"))throw Error(c.warmIntroduction);b.generatedPitch=c,b.currentAiResponseText=c.warmIntroduction}else if("PROCESS_USER_RESPONSE"===c){if(!e){let a=["Just wanted to check if you were still there. I'm ready whenever you are.","Just checking in, I'm here when you're ready to continue.","Is there anything I can clarify for you?","I am waiting for your response."];return b.currentAiResponseText=a[f%a.length],b.nextExpectedAction="USER_RESPONSE",b}if(!b.generatedPitch)throw Error("Cannot process response: The initial sales pitch has not been generated yet.");let a=await l({conversationHistory:p(b.conversationTurns,6),lastUserResponse:e});switch(a.output?.action){case"CONTINUE_PITCH":let c=((a,b)=>{let c=new Set(a.filter(a=>"AI"===a.speaker).map(a=>a.text));return c.has(b.personalizedHook)?c.has(b.productExplanation)?c.has(b.keyBenefitsAndBundles)?c.has(b.discountOrDealExplanation)?c.has(b.objectionHandlingPreviews)?{text:b.finalCallToAction,isFinal:!0}:{text:b.objectionHandlingPreviews,isFinal:!1}:{text:b.discountOrDealExplanation,isFinal:!1}:{text:b.keyBenefitsAndBundles,isFinal:!1}:{text:b.productExplanation,isFinal:!1}:{text:b.personalizedHook,isFinal:!1}})(b.conversationTurns,b.generatedPitch);b.currentAiResponseText=c.text,c.isFinal&&(b.nextExpectedAction="INTERACTION_ENDED");break;case"ANSWER_SALES_QUESTION":let h=await m({userQuestion:e,knowledgeBaseContext:d,conversationHistory:p(b.conversationTurns,8),brandUrl:g});b.currentAiResponseText=h.output?.answer;break;case"ANSWER_SUPPORT_QUESTION":let i=await n({userQuestion:e,knowledgeBaseContext:d,conversationHistory:p(b.conversationTurns,8),brandUrl:g});b.currentAiResponseText=i.output?.answer;break;case"HANDLE_SALES_OBJECTION":let j=await o({userObjection:e,knowledgeBaseContext:d,conversationHistory:p(b.conversationTurns,8),brandUrl:g});b.currentAiResponseText=j.output?.rebuttal;break;case"CLOSING_STATEMENT":b.currentAiResponseText="I understand. Thank you for your time. Have a great day!",b.nextExpectedAction="INTERACTION_ENDED";break;case"ACKNOWLEDGE_AND_WAIT":b.currentAiResponseText="Okay.";break;default:b.currentAiResponseText="I'm sorry, I'm not sure how to respond to that. Could you clarify?"}}else if("END_CALL"===c)b.currentAiResponseText=`Thank you for your time, ${a.userName||"sir/ma'am"}. Have a great day.`,b.nextExpectedAction="INTERACTION_ENDED";else throw Error(`Invalid action received by the flow: ${c}.`);return b}catch(c){console.error("Critical Unhandled Error in runVoiceSalesAgentTurn:",JSON.stringify(c,Object.getOwnPropertyNames(c),2));let a=`I'm sorry, a critical system error occurred. Details: ${c.message.substring(0,200)}...`;return b.errorMessage=c.message,b.currentAiResponseText=a,b.nextExpectedAction="END_CALL_NO_SCORE",b}});async function r(a){return q(a)}(0,k.D)([r]),(0,e.A)(r,"40481652c6e515f70ff0f4f0899456d583cb098e56",null);var s=c(10685)},81630:a=>{"use strict";a.exports=require("http")},84297:a=>{"use strict";a.exports=require("async_hooks")},86293:(a,b,c)=>{Promise.resolve().then(c.bind(c,17558))},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91645:a=>{"use strict";a.exports=require("net")},94735:a=>{"use strict";a.exports=require("events")}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[5873,1428,5917,308,7506,8017,4550,7786,5938,5477,2178,9533,102,6903],()=>b(b.s=72412));module.exports=c})();